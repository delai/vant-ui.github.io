import{c as R,i as Te,e as w,H as z,u as ae,n as le,l as ce,b as ie,p as J,I as pe,J as Y}from"./use-translate-113fec30.js";import{u as se}from"./use-expose-89a7ef05.js";import{L as Oe}from"./index-ae779a94.js";import{u as xe}from"./use-touch-e98b6450.js";import{n as L,d as N,b as V,c as _,t as Ce,m as ke}from"./with-install-a70dfb01.js";import{A as $,y,D as C,R as ye,e as r,u as H,Q as Se,B as Ee,q as X}from"./vue-libs-12a1683e.js";import{H as Z,a as Pe}from"./constant-a81ffd37.js";import{T as we,a as Ie}from"./index-a24498af.js";const[Be,O,ee]=R("picker"),ue=e=>e.find(o=>!o.disabled)||e[0];function He(e,o){const n=e[0];if(n){if(Array.isArray(n))return"multiple";if(o.children in n)return"cascade"}return"default"}function Q(e,o){o=z(o,0,e.length);for(let n=o;n<e.length;n++)if(!e[n].disabled)return n;for(let n=o-1;n>=0;n--)if(!e[n].disabled)return n;return 0}const te=(e,o,n)=>o!==void 0&&!!e.find(c=>c[n.value]===o);function W(e,o,n){const c=e.findIndex(v=>v[n.value]===o),i=Q(e,c);return e[i]}function De(e,o,n){const c=[];let i={[o.children]:e},v=0;for(;i&&i[o.children];){const d=i[o.children],h=n.value[v];if(i=Te(h)?W(d,h,o):void 0,!i&&d.length){const u=ue(d)[o.value];i=W(d,u,o)}v++,c.push(d)}return c}function Me(e){const{transform:o}=window.getComputedStyle(e),n=o.slice(7,o.length-1).split(", ")[5];return Number(n)}function Ne(e){return w({text:"text",value:"value",children:"children"},e)}const ne=200,oe=300,_e=15,[re,G]=R("picker-column"),me=Symbol(re),Ve=$({name:re,props:{value:L,fields:N(Object),options:V(),readonly:Boolean,allowHtml:Boolean,optionHeight:N(Number),swipeDuration:N(L),visibleOptionNum:N(L)},emits:["change","clickOption","scrollInto"],setup(e,{emit:o,slots:n}){let c,i,v,d,h;const u=y(),b=y(),m=y(0),f=y(0),g=xe(),T=()=>e.options.length,S=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,k=s=>{const t=Q(e.options,s),a=-t*e.optionHeight,l=()=>{const x=e.options[t][e.fields.value];x!==e.value&&o("change",x)};c&&a!==m.value?h=l:l(),m.value=a},p=()=>e.readonly||!e.options.length,U=s=>{c||p()||(h=null,f.value=ne,k(s),o("clickOption",e.options[s]))},E=s=>z(Math.round(-s/e.optionHeight),0,T()-1),D=C(()=>E(m.value)),j=(s,t)=>{const a=Math.abs(s/t);s=m.value+a/.003*(s<0?-1:1);const l=E(s);f.value=+e.swipeDuration,k(l)},M=()=>{c=!1,f.value=0,h&&(h(),h=null)},F=s=>{if(!p()){if(g.start(s),c){const t=Me(b.value);m.value=Math.min(0,t-S())}f.value=0,i=m.value,v=Date.now(),d=i,h=null}},K=s=>{if(p())return;g.move(s),g.isVertical()&&(c=!0,ce(s,!0));const t=z(i+g.deltaY.value,-(T()*e.optionHeight),e.optionHeight),a=E(t);a!==D.value&&o("scrollInto",e.options[a]),m.value=t;const l=Date.now();l-v>oe&&(v=l,d=t)},I=()=>{if(p())return;const s=m.value-d,t=Date.now()-v;if(t<oe&&Math.abs(s)>_e){j(s,t);return}const l=E(m.value);f.value=ne,k(l),setTimeout(()=>{c=!1},0)},P=()=>{const s={height:`${e.optionHeight}px`};return e.options.map((t,a)=>{const l=t[e.fields.text],{disabled:x}=t,B=t[e.fields.value],be={role:"button",style:s,tabindex:x?-1:0,class:[G("item",{disabled:x,selected:B===e.value}),t.className],onClick:()=>U(a)},ge={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:l};return r("li",be,[n.option?n.option(t,a):r("div",ge,null)])})};return ae(me),se({stopMomentum:M}),ye(()=>{const s=e.options.findIndex(l=>l[e.fields.value]===e.value),a=-Q(e.options,s)*e.optionHeight;m.value=a}),le("touchmove",K,{target:u}),()=>r("div",{ref:u,class:G(),onTouchstartPassive:F,onTouchend:I,onTouchcancel:I},[r("ul",{ref:b,style:{transform:`translate3d(0, ${m.value+S()}px, 0)`,transitionDuration:`${f.value}ms`,transitionProperty:f.value?"all":"none"},class:G("wrapper"),onTransitionend:M},[P()])])}}),[Re]=R("picker-toolbar"),A={title:String,cancelButtonText:String,confirmButtonText:String},de=["cancel","confirm","title","toolbar"],$e=Object.keys(A),fe=$({name:Re,props:A,emits:["confirm","cancel"],setup(e,{emit:o,slots:n}){const c=()=>{if(n.title)return n.title();if(e.title)return r("div",{class:[O("title"),"van-ellipsis"]},[e.title])},i=()=>o("cancel"),v=()=>o("confirm"),d=()=>{const u=e.cancelButtonText||ee("cancel");return r("button",{type:"button",class:[O("cancel"),Z],onClick:i},[n.cancel?n.cancel():u])},h=()=>{const u=e.confirmButtonText||ee("confirm");return r("button",{type:"button",class:[O("confirm"),Z],onClick:v},[n.confirm?n.confirm():u])};return()=>r("div",{class:O("toolbar")},[n.toolbar?n.toolbar():[d(),c(),h()]])}}),Ae=(e,o)=>{const n=y(e());return H(e,c=>{c!==n.value&&(n.value=c)}),H(n,c=>{c!==e()&&o(c)}),n};function Ue(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Se(e)}const[ve,q]=R("picker-group"),he=Symbol(ve),je=w({tabs:V(),activeTab:_(0),nextStepText:String},A),Xe=$({name:ve,props:je,emits:["confirm","cancel","update:activeTab"],setup(e,{emit:o,slots:n}){const c=Ae(()=>e.activeTab,b=>o("update:activeTab",b)),{children:i,linkChildren:v}=ie(he);v();const d=()=>+c.value<e.tabs.length-1&&e.nextStepText,h=()=>{d()?c.value=+c.value+1:o("confirm",i.map(b=>b.confirm()))},u=()=>o("cancel");return()=>{var g;let b;const m=(g=n.default)==null?void 0:g.call(n),f=d()?e.nextStepText:e.confirmButtonText;return r("div",{class:q()},[r(fe,{title:e.title,cancelButtonText:e.cancelButtonText,confirmButtonText:f,onConfirm:h,onCancel:u},J(n,de)),r(we,{active:c.value,"onUpdate:active":T=>c.value=T,class:q("tabs"),shrink:!0,animated:!0,lazyRender:!1},Ue(b=e.tabs.map((T,S)=>r(Ie,{title:T,titleClass:q("tab-title")},{default:()=>[m==null?void 0:m[S]]})))?b:{default:()=>[b]})])}}}),Fe=w({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:_(44),showToolbar:Ce,swipeDuration:_(1e3),visibleOptionNum:_(6)},A),Ke=w({},Fe,{columns:V(),modelValue:V(),toolbarPosition:ke("top"),columnsFieldNames:Object}),Ze=$({name:Be,props:Ke,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:o,slots:n}){const c=y(),i=y(e.modelValue.slice(0)),{parent:v}=ae(he),{children:d,linkChildren:h}=ie(me);h();const u=C(()=>Ne(e.columnsFieldNames)),b=C(()=>pe(e.optionHeight)),m=C(()=>He(e.columns,u.value)),f=C(()=>{const{columns:t}=e;switch(m.value){case"multiple":return t;case"cascade":return De(t,u.value,i);default:return[t]}}),g=C(()=>f.value.some(t=>t.length)),T=C(()=>f.value.map((t,a)=>W(t,i.value[a],u.value))),S=C(()=>f.value.map((t,a)=>t.findIndex(l=>l[u.value.value]===i.value[a]))),k=(t,a)=>{if(i.value[t]!==a){const l=i.value.slice(0);l[t]=a,i.value=l}},p=()=>({selectedValues:i.value.slice(0),selectedOptions:T.value,selectedIndexes:S.value}),U=(t,a)=>{k(a,t),m.value==="cascade"&&i.value.forEach((l,x)=>{const B=f.value[x];te(B,l,u.value)||k(x,B.length?B[0][u.value.value]:void 0)}),X(()=>{o("change",w({columnIndex:a},p()))})},E=(t,a)=>{const l={columnIndex:a,currentOption:t};o("clickOption",w(p(),l)),o("scrollInto",l)},D=()=>{d.forEach(a=>a.stopMomentum());const t=p();return X(()=>{o("confirm",t)}),t},j=()=>o("cancel",p()),M=()=>f.value.map((t,a)=>r(Ve,{value:i.value[a],fields:u.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:b.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:l=>U(l,a),onClickOption:l=>E(l,a),onScrollInto:l=>{o("scrollInto",{currentOption:l,columnIndex:a})}},{option:n.option})),F=t=>{if(g.value){const a={height:`${b.value}px`},l={backgroundSize:`100% ${(t-b.value)/2}px`};return[r("div",{class:O("mask"),style:l},null),r("div",{class:[Pe,O("frame")],style:a},null)]}},K=()=>{const t=b.value*+e.visibleOptionNum,a={height:`${t}px`};return r("div",{ref:c,class:O("columns"),style:a},[M(),F(t)])},I=()=>{if(e.showToolbar&&!v)return r(fe,Ee(J(e,$e),{onConfirm:D,onCancel:j}),J(n,de))};H(f,t=>{t.forEach((a,l)=>{a.length&&!te(a,i.value[l],u.value)&&k(l,ue(a)[u.value.value])})},{immediate:!0});let P;return H(()=>e.modelValue,t=>{!Y(t,i.value)&&!Y(t,P)&&(i.value=t.slice(0),P=t.slice(0))},{deep:!0}),H(i,t=>{Y(t,e.modelValue)||(P=t.slice(0),o("update:modelValue",P))},{immediate:!0}),le("touchmove",ce,{target:c}),se({confirm:D,getSelectedOptions:()=>T.value}),()=>{var t,a;return r("div",{class:O()},[e.toolbarPosition==="top"?I():null,e.loading?r(Oe,{class:O("loading")},null):null,(t=n["columns-top"])==null?void 0:t.call(n),K(),(a=n["columns-bottom"])==null?void 0:a.call(n),e.toolbarPosition==="bottom"?I():null])}}});export{Ze as _,Xe as a,Fe as p,Ae as u};
