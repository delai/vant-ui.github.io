import{c as V,i as be,e as E,F as q,u as ne,n as oe,l as ae,b as le,G as ge,H as j,p as J}from"./use-translate.7b7055b3.js";import{n as K,d as N,b as B,c as U,t as pe,m as Te}from"./with-install.a0877b0b.js";import{H as W,a as Oe}from"./constant.e12a51b9.js";import{u as ce}from"./use-expose.77504c28.js";import{L as Ce}from"./index.d7a56972.js";import{u as ke}from"./use-touch.e8c4f7e8.js";import{A as _,u as x,R as ye,e as m,B as ie,Q as xe,D as y,x as Y,q as Ee}from"./vue-libs.d5ee895a.js";import{T as Pe,a as Se}from"./index.b6891a8c.js";const[we,g,X]=V("picker"),se=e=>e.find(o=>!o.disabled)||e[0];function He(e,o){const n=e[0];if(n){if(Array.isArray(n))return"multiple";if(o.children in n)return"cascade"}return"default"}function z(e,o){o=q(o,0,e.length);for(let n=o;n<e.length;n++)if(!e[n].disabled)return n;for(let n=o-1;n>=0;n--)if(!e[n].disabled)return n;return 0}const Z=(e,o,n)=>o!==void 0&&!!e.find(u=>u[n.value]===o);function Q(e,o,n){const u=e.findIndex(f=>f[n.value]===o),l=z(e,u);return e[l]}function De(e,o,n){const u=[];let l={[o.children]:e},f=0;for(;l&&l[o.children];){const v=l[o.children],r=n.value[f];if(l=be(r)?Q(v,r,o):void 0,!l&&v.length){const s=se(v)[o.value];l=Q(v,s,o)}f++,u.push(v)}return u}function Me(e){const{transform:o}=window.getComputedStyle(e),n=o.slice(7,o.length-1).split(", ")[5];return Number(n)}function Ne(e){return E({text:"text",value:"value",children:"children"},e)}const ee=200,te=300,Be=15,[ue,L]=V("picker-column"),re=Symbol(ue),Ve=_({name:ue,props:{value:K,fields:N(Object),options:B(),readonly:Boolean,allowHtml:Boolean,optionHeight:N(Number),swipeDuration:N(K),visibleOptionNum:N(K)},emits:["change","clickOption"],setup(e,{emit:o,slots:n}){let u,l,f,v,r;const s=x(),b=x(),d=x(0),h=x(0),O=ke(),P=()=>e.options.length,C=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,p=c=>{const t=z(e.options,c),a=-t*e.optionHeight,i=()=>{const T=e.options[t][e.fields.value];T!==e.value&&o("change",T)};u&&a!==d.value?r=i:i(),d.value=a},k=()=>e.readonly||!e.options.length,$=c=>{u||k()||(r=null,h.value=ee,p(c),o("clickOption",e.options[c]))},S=c=>q(Math.round(-c/e.optionHeight),0,P()-1),R=(c,t)=>{const a=Math.abs(c/t);c=d.value+a/.003*(c<0?-1:1);const i=S(c);h.value=+e.swipeDuration,p(i)},M=()=>{u=!1,h.value=0,r&&(r(),r=null)},A=c=>{if(!k()){if(O.start(c),u){const t=Me(b.value);d.value=Math.min(0,t-C())}h.value=0,l=d.value,f=Date.now(),v=l,r=null}},F=c=>{if(k())return;O.move(c),O.isVertical()&&(u=!0,ae(c,!0)),d.value=q(l+O.deltaY.value,-(P()*e.optionHeight),e.optionHeight);const t=Date.now();t-f>te&&(f=t,v=d.value)},w=()=>{if(k())return;const c=d.value-v,t=Date.now()-f;if(t<te&&Math.abs(c)>Be){R(c,t);return}const i=S(d.value);h.value=ee,p(i),setTimeout(()=>{u=!1},0)},H=()=>{const c={height:`${e.optionHeight}px`};return e.options.map((t,a)=>{const i=t[e.fields.text],{disabled:T}=t,D=t[e.fields.value],ve={role:"button",style:c,tabindex:T?-1:0,class:[L("item",{disabled:T,selected:D===e.value}),t.className],onClick:()=>$(a)},he={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:i};return m("li",ve,[n.option?n.option(t):m("div",he,null)])})};return ne(re),ce({stopMomentum:M}),ye(()=>{const c=e.options.findIndex(i=>i[e.fields.value]===e.value),a=-z(e.options,c)*e.optionHeight;d.value=a}),oe("touchmove",F,{target:s}),()=>m("div",{ref:s,class:L(),onTouchstartPassive:A,onTouchend:w,onTouchcancel:w},[m("ul",{ref:b,style:{transform:`translate3d(0, ${d.value+C()}px, 0)`,transitionDuration:`${h.value}ms`,transitionProperty:h.value?"all":"none"},class:L("wrapper"),onTransitionend:M},[H()])])}}),[_e]=V("picker-toolbar"),I={title:String,cancelButtonText:String,confirmButtonText:String},Ie=["cancel","confirm","title","toolbar"],$e=Object.keys(I),me=_({name:_e,props:I,emits:["confirm","cancel"],setup(e,{emit:o,slots:n}){const u=()=>{if(n.title)return n.title();if(e.title)return m("div",{class:[g("title"),"van-ellipsis"]},[e.title])},l=()=>o("cancel"),f=()=>o("confirm"),v=()=>{const s=e.cancelButtonText||X("cancel");return m("button",{type:"button",class:[g("cancel"),W],onClick:l},[n.cancel?n.cancel():s])},r=()=>{const s=e.confirmButtonText||X("confirm");return m("button",{type:"button",class:[g("confirm"),W],onClick:f},[n.confirm?n.confirm():s])};return()=>m("div",{class:g("toolbar")},[n.toolbar?n.toolbar():[v(),u(),r()]])}});function Re(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!xe(e)}const[de,G]=V("picker-group"),fe=Symbol(de),Ae=E({tabs:B()},I),Je=_({name:de,props:Ae,emits:["confirm","cancel"],setup(e,{emit:o,slots:n}){const{children:u,linkChildren:l}=le(fe);l();const f=()=>{o("confirm",u.map(r=>r.confirm()))},v=()=>o("cancel");return()=>{var b;let r;const s=(b=n.default)==null?void 0:b.call(n);return m("div",{class:G()},[m(me,ie(e,{onConfirm:f,onCancel:v}),null),m(Pe,{shrink:!0,class:G("tabs"),animated:!0},Re(r=e.tabs.map((d,h)=>m(Se,{title:d,titleClass:G("tab-title")},{default:()=>[s==null?void 0:s[h]]})))?r:{default:()=>[r]})])}}}),Fe=E({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:U(44),showToolbar:pe,swipeDuration:U(1e3),visibleOptionNum:U(6)},I),je=E({},Fe,{columns:B(),modelValue:B(),toolbarPosition:Te("top"),columnsFieldNames:Object}),We=_({name:we,props:je,emits:["confirm","cancel","change","clickOption","update:modelValue"],setup(e,{emit:o,slots:n}){const u=x(),l=x(e.modelValue.slice(0)),{parent:f}=ne(fe),{children:v,linkChildren:r}=le(re);r();const s=y(()=>Ne(e.columnsFieldNames)),b=y(()=>ge(e.optionHeight)),d=y(()=>He(e.columns,s.value)),h=y(()=>{const{columns:t}=e;switch(d.value){case"multiple":return t;case"cascade":return De(t,s.value,l);default:return[t]}}),O=y(()=>h.value.some(t=>t.length)),P=y(()=>h.value.map((t,a)=>Q(t,l.value[a],s.value))),C=(t,a)=>{if(l.value[t]!==a){const i=l.value.slice(0);i[t]=a,l.value=i}},p=()=>({selectedValues:l.value.slice(0),selectedOptions:P.value}),k=(t,a)=>{C(a,t),d.value==="cascade"&&l.value.forEach((i,T)=>{const D=h.value[T];Z(D,i,s.value)||C(T,D.length?D[0][s.value.value]:void 0)}),o("change",E({columnIndex:a},p()))},$=(t,a)=>o("clickOption",E({columnIndex:a,currentOption:t},p())),S=()=>{v.forEach(a=>a.stopMomentum());const t=p();return Ee(()=>{o("confirm",t)}),t},R=()=>o("cancel",p()),M=()=>h.value.map((t,a)=>m(Ve,{value:l.value[a],fields:s.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:b.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:i=>k(i,a),onClickOption:i=>$(i,a)},{option:n.option})),A=t=>{if(O.value){const a={height:`${b.value}px`},i={backgroundSize:`100% ${(t-b.value)/2}px`};return[m("div",{class:g("mask"),style:i},null),m("div",{class:[Oe,g("frame")],style:a},null)]}},F=()=>{const t=b.value*+e.visibleOptionNum,a={height:`${t}px`};return m("div",{ref:u,class:g("columns"),style:a},[M(),A(t)])},w=()=>{if(e.showToolbar&&!f)return m(me,ie(J(e,$e),{onConfirm:S,onCancel:R}),J(n,Ie))};Y(h,t=>{t.forEach((a,i)=>{a.length&&!Z(a,l.value[i],s.value)&&C(i,se(a)[s.value.value])})},{immediate:!0});let H;return Y(()=>e.modelValue,t=>{!j(t,l.value)&&!j(t,H)&&(l.value=t.slice(0))},{deep:!0}),Y(l,t=>{j(t,e.modelValue)||(H=t.slice(0),o("update:modelValue",H))},{immediate:!0}),oe("touchmove",ae,{target:u}),ce({confirm:S,getSelectedOptions:()=>P.value}),()=>{var t,a;return m("div",{class:g()},[e.toolbarPosition==="top"?w():null,e.loading?m(Ce,{class:g("loading")},null):null,(t=n["columns-top"])==null?void 0:t.call(n),F(),(a=n["columns-bottom"])==null?void 0:a.call(n),e.toolbarPosition==="bottom"?w():null])}}});export{We as _,Je as a,Fe as p};
