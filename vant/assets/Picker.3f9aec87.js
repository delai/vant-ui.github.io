import{c as _,i as be,e as x,H as z,u as oe,n as ae,l as le,b as ce,I as ge,J as K,p as W}from"./use-translate.a029ce72.js";import{n as U,d as B,b as V,c as Y,t as pe,m as Te}from"./with-install.1dc27775.js";import{H as X,a as Oe}from"./constant.e12a51b9.js";import{u as ie}from"./use-expose.c6c7f4f7.js";import{L as Ce}from"./index.cacc54a3.js";import{u as ke}from"./use-touch.e8c4f7e8.js";import{A as $,u as y,R as ye,e as d,B as se,Q as xe,D as C,x as L,q as Ee}from"./vue-libs.d5ee895a.js";import{T as Pe,a as Se}from"./index.ab6be629.js";const[we,T,Z]=_("picker"),ue=e=>e.find(a=>!a.disabled)||e[0];function He(e,a){const n=e[0];if(n){if(Array.isArray(n))return"multiple";if(a.children in n)return"cascade"}return"default"}function J(e,a){a=z(a,0,e.length);for(let n=a;n<e.length;n++)if(!e[n].disabled)return n;for(let n=a-1;n>=0;n--)if(!e[n].disabled)return n;return 0}const ee=(e,a,n)=>a!==void 0&&!!e.find(u=>u[n.value]===a);function Q(e,a,n){const u=e.findIndex(h=>h[n.value]===a),l=J(e,u);return e[l]}function De(e,a,n){const u=[];let l={[a.children]:e},h=0;for(;l&&l[a.children];){const b=l[a.children],m=n.value[h];if(l=be(m)?Q(b,m,a):void 0,!l&&b.length){const i=ue(b)[a.value];l=Q(b,i,a)}h++,u.push(b)}return u}function Me(e){const{transform:a}=window.getComputedStyle(e),n=a.slice(7,a.length-1).split(", ")[5];return Number(n)}function Ne(e){return x({text:"text",value:"value",children:"children"},e)}const te=200,ne=300,Ie=15,[re,G]=_("picker-column"),me=Symbol(re),Be=$({name:re,props:{value:U,fields:B(Object),options:V(),readonly:Boolean,allowHtml:Boolean,optionHeight:B(Number),swipeDuration:B(U),visibleOptionNum:B(U)},emits:["change","clickOption"],setup(e,{emit:a,slots:n}){let u,l,h,b,m;const i=y(),g=y(),f=y(0),v=y(0),k=ke(),E=()=>e.options.length,S=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,O=c=>{const r=J(e.options,c),t=-r*e.optionHeight,o=()=>{const s=e.options[r][e.fields.value];s!==e.value&&a("change",s)};u&&t!==f.value?m=o:o(),f.value=t},p=()=>e.readonly||!e.options.length,A=c=>{u||p()||(m=null,v.value=te,O(c),a("clickOption",e.options[c]))},w=c=>z(Math.round(-c/e.optionHeight),0,E()-1),H=(c,r)=>{const t=Math.abs(c/r);c=f.value+t/.003*(c<0?-1:1);const o=w(c);v.value=+e.swipeDuration,O(o)},D=()=>{u=!1,v.value=0,m&&(m(),m=null)},j=c=>{if(!p()){if(k.start(c),u){const r=Me(g.value);f.value=Math.min(0,r-S())}v.value=0,l=f.value,h=Date.now(),b=l,m=null}},F=c=>{if(p())return;k.move(c),k.isVertical()&&(u=!0,le(c,!0)),f.value=z(l+k.deltaY.value,-(E()*e.optionHeight),e.optionHeight);const r=Date.now();r-h>ne&&(h=r,b=f.value)},M=()=>{if(p())return;const c=f.value-b,r=Date.now()-h;if(r<ne&&Math.abs(c)>Ie){H(c,r);return}const o=w(f.value);v.value=te,O(o),setTimeout(()=>{u=!1},0)},N=()=>{const c={height:`${e.optionHeight}px`};return e.options.map((r,t)=>{const o=r[e.fields.text],{disabled:s}=r,I=r[e.fields.value],P={role:"button",style:c,tabindex:s?-1:0,class:[G("item",{disabled:s,selected:I===e.value}),r.className],onClick:()=>A(t)},he={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:o};return d("li",P,[n.option?n.option(r):d("div",he,null)])})};return oe(me),ie({stopMomentum:D}),ye(()=>{const c=e.options.findIndex(o=>o[e.fields.value]===e.value),t=-J(e.options,c)*e.optionHeight;f.value=t}),ae("touchmove",F,{target:i}),()=>d("div",{ref:i,class:G(),onTouchstartPassive:j,onTouchend:M,onTouchcancel:M},[d("ul",{ref:g,style:{transform:`translate3d(0, ${f.value+S()}px, 0)`,transitionDuration:`${v.value}ms`,transitionProperty:v.value?"all":"none"},class:G("wrapper"),onTransitionend:D},[N()])])}}),[Ve]=_("picker-toolbar"),R={title:String,cancelButtonText:String,confirmButtonText:String},_e=["cancel","confirm","title","toolbar"],$e=Object.keys(R),de=$({name:Ve,props:R,emits:["confirm","cancel"],setup(e,{emit:a,slots:n}){const u=()=>{if(n.title)return n.title();if(e.title)return d("div",{class:[T("title"),"van-ellipsis"]},[e.title])},l=()=>a("cancel"),h=()=>a("confirm"),b=()=>{const i=e.cancelButtonText||Z("cancel");return d("button",{type:"button",class:[T("cancel"),X],onClick:l},[n.cancel?n.cancel():i])},m=()=>{const i=e.confirmButtonText||Z("confirm");return d("button",{type:"button",class:[T("confirm"),X],onClick:h},[n.confirm?n.confirm():i])};return()=>d("div",{class:T("toolbar")},[n.toolbar?n.toolbar():[b(),u(),m()]])}});function Re(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!xe(e)}const[fe,q]=_("picker-group"),ve=Symbol(fe),Ae=x({tabs:V()},R),Qe=$({name:fe,props:Ae,emits:["confirm","cancel"],setup(e,{emit:a,slots:n}){const{children:u,linkChildren:l}=ce(ve);l();const h=()=>{a("confirm",u.map(m=>m.confirm()))},b=()=>a("cancel");return()=>{var g;let m;const i=(g=n.default)==null?void 0:g.call(n);return d("div",{class:q()},[d(de,se(e,{onConfirm:h,onCancel:b}),null),d(Pe,{shrink:!0,class:q("tabs"),animated:!0},Re(m=e.tabs.map((f,v)=>d(Se,{title:f,titleClass:q("tab-title")},{default:()=>[i==null?void 0:i[v]]})))?m:{default:()=>[m]})])}}}),je=x({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:Y(44),showToolbar:pe,swipeDuration:Y(1e3),visibleOptionNum:Y(6)},R),Fe=x({},je,{columns:V(),modelValue:V(),toolbarPosition:Te("top"),columnsFieldNames:Object}),We=$({name:we,props:Fe,emits:["confirm","cancel","change","clickOption","update:modelValue"],setup(e,{emit:a,slots:n}){const u=y(),l=y(e.modelValue.slice(0)),{parent:h}=oe(ve),{children:b,linkChildren:m}=ce(me);m();const i=C(()=>Ne(e.columnsFieldNames)),g=C(()=>ge(e.optionHeight)),f=C(()=>He(e.columns,i.value)),v=C(()=>{const{columns:t}=e;switch(f.value){case"multiple":return t;case"cascade":return De(t,i.value,l);default:return[t]}}),k=C(()=>v.value.some(t=>t.length)),E=C(()=>v.value.map((t,o)=>Q(t,l.value[o],i.value))),S=C(()=>v.value.map((t,o)=>t.findIndex(s=>s[i.value.value]===l.value[o]))),O=(t,o)=>{if(l.value[t]!==o){const s=l.value.slice(0);s[t]=o,l.value=s}},p=()=>({selectedValues:l.value.slice(0),selectedOptions:E.value,selectedIndexes:S.value}),A=(t,o)=>{O(o,t),f.value==="cascade"&&l.value.forEach((s,I)=>{const P=v.value[I];ee(P,s,i.value)||O(I,P.length?P[0][i.value.value]:void 0)}),a("change",x({columnIndex:o},p()))},w=(t,o)=>a("clickOption",x({columnIndex:o,currentOption:t},p())),H=()=>{b.forEach(o=>o.stopMomentum());const t=p();return Ee(()=>{a("confirm",t)}),t},D=()=>a("cancel",p()),j=()=>v.value.map((t,o)=>d(Be,{value:l.value[o],fields:i.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:g.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:s=>A(s,o),onClickOption:s=>w(s,o)},{option:n.option})),F=t=>{if(k.value){const o={height:`${g.value}px`},s={backgroundSize:`100% ${(t-g.value)/2}px`};return[d("div",{class:T("mask"),style:s},null),d("div",{class:[Oe,T("frame")],style:o},null)]}},M=()=>{const t=g.value*+e.visibleOptionNum,o={height:`${t}px`};return d("div",{ref:u,class:T("columns"),style:o},[j(),F(t)])},N=()=>{if(e.showToolbar&&!h)return d(de,se(W(e,$e),{onConfirm:H,onCancel:D}),W(n,_e))};L(v,t=>{t.forEach((o,s)=>{o.length&&!ee(o,l.value[s],i.value)&&O(s,ue(o)[i.value.value])})},{immediate:!0});let c;return L(()=>e.modelValue,t=>{!K(t,l.value)&&!K(t,c)&&(l.value=t.slice(0))},{deep:!0}),L(l,t=>{K(t,e.modelValue)||(c=t.slice(0),a("update:modelValue",c))},{immediate:!0}),ae("touchmove",le,{target:u}),ie({confirm:H,getSelectedOptions:()=>E.value}),()=>{var t,o;return d("div",{class:T()},[e.toolbarPosition==="top"?N():null,e.loading?d(Ce,{class:T("loading")},null):null,(t=n["columns-top"])==null?void 0:t.call(n),M(),(o=n["columns-bottom"])==null?void 0:o.call(n),e.toolbarPosition==="bottom"?N():null])}}});export{We as _,Qe as a,je as p};
