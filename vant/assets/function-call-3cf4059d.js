import{m as ee,u as oe}from"./mount-component-14ebcfe9.js";import{n as te,c as B,l as W,H as T,w as ae,r as se,p as ne,s as ie,d as re,e as ce}from"./use-translate-eec47ef5.js";import{u as le}from"./use-expose-963cf204.js";import{I as me}from"./index-4fa7f56f.js";import{a as ue,S as de}from"./index-4151f0ce.js";import{P as ge}from"./index-33946f24.js";import{u as fe}from"./use-touch-e98b6450.js";import{I as ve}from"./index-f4d32304.js";import{L as he}from"./index-ab1aa43b.js";import{A as L,H as j,y as F,D as Z,u as X,e as l,M as we,q as Pe,B as q,Q as pe}from"./vue-libs-12a1683e.js";import{d as D,n as _,t as R,b as Se,c as M,u as k,m as O}from"./with-install-99dfa70d.js";import{L as Ie,H as xe}from"./constant-a81ffd37.js";import{c as ye}from"./interceptor-a4a72906.js";const $=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),E=B("image-preview")[1],be=L({props:{src:String,show:Boolean,active:Number,minZoom:D(_),maxZoom:D(_),rootWidth:D(Number),rootHeight:D(Number),disableZoom:Boolean},emits:["scale","close","longPress"],setup(e,{emit:r,slots:m}){const o=j({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),s=fe(),w=F(),I=Z(()=>{const{rootWidth:t,rootHeight:n}=e,i=n/t;return o.imageRatio>i}),H=Z(()=>{const{scale:t,moveX:n,moveY:i,moving:f,zooming:v}=o,Y={transitionDuration:v||f?"0s":".3s"};if(t!==1){const Q=n/t,J=i/t;Y.transform=`scale(${t}, ${t}) translate(${Q}px, ${J}px)`}return Y}),u=Z(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:n}=e,i=I.value?n/o.imageRatio:t;return Math.max(0,(o.scale*i-t)/2)}return 0}),d=Z(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:n}=e,i=I.value?n:t*o.imageRatio;return Math.max(0,(o.scale*i-n)/2)}return 0}),x=t=>{t=T(t,+e.minZoom,+e.maxZoom+1),t!==o.scale&&(o.scale=t,r("scale",{scale:t,index:e.active}))},y=()=>{x(1),o.moveX=0,o.moveY=0},N=()=>{const t=o.scale>1?1:2;x(t),o.moveX=0,o.moveY=0};let h,P,p,b,C,a,g,c=!1;const U=t=>{const{touches:n}=t;if(h=n.length,h===2&&e.disableZoom)return;const{offsetX:i}=s;s.start(t),P=o.moveX,p=o.moveY,g=Date.now(),c=!1,o.moving=h===1&&o.scale!==1,o.zooming=h===2&&!i.value,o.zooming&&(b=o.scale,C=$(t.touches))},V=t=>{const{touches:n}=t;if(s.move(t),o.moving){const{deltaX:i,deltaY:f}=s,v=i.value+P,Y=f.value+p;if((v>u.value||v<-u.value)&&!c&&s.isHorizontal()){o.moving=!1;return}c=!0,W(t,!0),o.moveX=T(v,-u.value,u.value),o.moveY=T(Y,-d.value,d.value)}if(o.zooming&&(W(t,!0),n.length===2)){const i=$(n),f=b*i/C;x(f)}},G=()=>{if(h>1)return;const{offsetX:t,offsetY:n}=s,i=Date.now()-g,f=250,v=5;t.value<v&&n.value<v&&(i<f?a?(clearTimeout(a),a=null,N()):a=setTimeout(()=>{r("close"),a=null},f):i>Ie&&r("longPress"))},A=t=>{let n=!1;if((o.moving||o.zooming)&&(n=!0,o.moving&&P===o.moveX&&p===o.moveY&&(n=!1),!t.touches.length)){o.zooming&&(o.moveX=T(o.moveX,-u.value,u.value),o.moveY=T(o.moveY,-d.value,d.value),o.zooming=!1),o.moving=!1,P=0,p=0,b=1,o.scale<1&&y();const i=+e.maxZoom;o.scale>i&&(o.scale=i)}W(t,n),G(),s.reset()},K=t=>{const{naturalWidth:n,naturalHeight:i}=t.target;o.imageRatio=i/n};return X(()=>e.active,y),X(()=>e.show,t=>{t||y()}),te("touchmove",V,{target:Z(()=>{var t;return(t=w.value)==null?void 0:t.$el})}),()=>{const t={loading:()=>l(he,{type:"spinner"},null)};return l(ue,{ref:w,class:E("swipe-item"),onTouchstartPassive:U,onTouchend:A,onTouchcancel:A},{default:()=>[m.image?l("div",{class:E("image-wrap")},[m.image({src:e.src})]):l(ve,{src:e.src,fit:"contain",class:E("image",{vertical:I.value}),style:H.value,onLoad:K},t)]})}}});function Ce(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!pe(e)}const[Te,S]=B("image-preview"),Ze=["show","teleport","transition","overlayStyle","closeOnPopstate"],Xe={show:Boolean,loop:R,images:Se(),minZoom:M(1/3),maxZoom:M(3),overlay:R,closeable:Boolean,showIndex:R,className:k,closeIcon:O("clear"),transition:String,beforeClose:Function,overlayClass:k,overlayStyle:Object,swipeDuration:M(300),startPosition:M(0),showIndicators:Boolean,closeOnPopstate:R,closeIconPosition:O("top-right"),teleport:[String,Object]},He=L({name:Te,props:Xe,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:r,slots:m}){const o=F(),s=j({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),w=()=>{if(o.value){const a=ie(o.value.$el);s.rootWidth=a.width,s.rootHeight=a.height,o.value.resize()}},I=a=>r("scale",a),H=a=>r("update:show",a),u=()=>{ye(e.beforeClose,{args:[s.active],done:()=>H(!1)})},d=a=>{a!==s.active&&(s.active=a,r("change",a))},x=()=>{if(e.showIndex)return l("div",{class:S("index")},[m.index?m.index({index:s.active}):`${s.active+1} / ${e.images.length}`])},y=()=>{if(m.cover)return l("div",{class:S("cover")},[m.cover()])},N=()=>{s.disableZoom=!0},h=()=>{s.disableZoom=!1},P=()=>{let a;return l(de,{ref:o,lazyRender:!0,loop:e.loop,class:S("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:d,onDragEnd:h,onDragStart:N},Ce(a=e.images.map((g,c)=>l(be,{src:g,show:e.show,active:s.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:s.rootWidth,rootHeight:s.rootHeight,disableZoom:s.disableZoom,onScale:I,onClose:u,onLongPress:()=>r("longPress",{index:c})},{image:m.image})))?a:{default:()=>[a]})},p=()=>{if(e.closeable)return l(me,{role:"button",name:e.closeIcon,class:[S("close-icon",e.closeIconPosition),xe],onClick:u},null)},b=()=>r("closed"),C=(a,g)=>{var c;return(c=o.value)==null?void 0:c.swipeTo(a,g)};return le({swipeTo:C}),we(w),X([ae,se],w),X(()=>e.startPosition,a=>d(+a)),X(()=>e.show,a=>{const{images:g,startPosition:c}=e;a?(d(+c),Pe(()=>{w(),C(+c,{immediate:!0})})):r("close",{index:s.active,url:g[s.active]})}),()=>l(ge,q({class:[S(),e.className],overlayClass:[S("overlay"),e.overlayClass],onClosed:b,"onUpdate:show":H},ne(e,Ze)),{default:()=>[p(),P(),x(),y()]})}});let z;const Ye={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function De(){({instance:z}=ee({setup(){const{state:e,toggle:r}=oe(),m=()=>{e.images=[]};return()=>l(He,q(e,{onClosed:m,"onUpdate:show":r}),null)}}))}const je=(e,r=0)=>{if(re)return z||De(),e=Array.isArray(e)?{images:e,startPosition:r}:e,z.open(ce({},Ye,e)),z};export{He as _,je as s};
