import{m as ae,u as se}from"./mount-component-8e763b0d.js";import{n as ne,c as F,l as E,H as P,s as q,w as ie,r as le,p as re,d as ce,e as me}from"./use-translate-113fec30.js";import{u as ue}from"./use-expose-89a7ef05.js";import{I as de}from"./index-b61a6a2b.js";import{a as ve,S as ge}from"./index-f6d18d61.js";import{P as fe}from"./index-1046b10f.js";import{u as he}from"./use-touch-e98b6450.js";import{I as we}from"./index-01a8c03b.js";import{L as Pe}from"./index-ae779a94.js";import{A as U,H as V,y as _,D as X,u as Y,e as d,M as ye,q as Se,B as G,Q as pe}from"./vue-libs-12a1683e.js";import{d as R,n as O,t as D,b as xe,c as M,u as B,m as L}from"./with-install-a70dfb01.js";import{L as Ie,H as be}from"./constant-a81ffd37.js";import{c as Ce}from"./interceptor-8283b88e.js";const j=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),Te=e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}),A=F("image-preview")[1],Xe=U({props:{src:String,show:Boolean,active:Number,minZoom:R(O),maxZoom:R(O),rootWidth:R(Number),rootHeight:R(Number),disableZoom:Boolean},emits:["scale","close","longPress"],setup(e,{emit:l,slots:v}){const o=V({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),s=he(),y=_(),Z=_(),S=X(()=>{const{rootWidth:t,rootHeight:a}=e,n=a/t;return o.imageRatio>n}),H=X(()=>{const{scale:t,moveX:a,moveY:n,moving:u,zooming:c}=o,w={transitionDuration:c||u?"0s":".3s"};return t!==1&&(w.transform=`matrix(${t}, 0, 0, ${t}, ${a}, ${n})`),w}),m=X(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:a}=e,n=S.value?a/o.imageRatio:t;return Math.max(0,(o.scale*n-t)/2)}return 0}),f=X(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:a}=e,n=S.value?a:t*o.imageRatio;return Math.max(0,(o.scale*n-a)/2)}return 0}),p=(t,a)=>{var n;if(t=P(t,+e.minZoom,+e.maxZoom+1),t!==o.scale){const u=t/o.scale;if(o.scale=t,a){const c=q((n=y.value)==null?void 0:n.$el),w={x:c.width*.5,y:c.height*.5},oe=o.moveX-(a.x-c.left-w.x)*(u-1),te=o.moveY-(a.y-c.top-w.y)*(u-1);o.moveX=P(oe,-m.value,m.value),o.moveY=P(te,-f.value,f.value)}else o.moveX=0,o.moveY=0;l("scale",{scale:t,index:e.active})}},T=()=>{p(1)},N=()=>{const t=o.scale>1?1:2;p(t,t===2?{x:s.startX.value,y:s.startY.value}:void 0)};let h,x,I,b,i,g,r,$,W=!1;const K=t=>{const{touches:a}=t;if(h=a.length,h===2&&e.disableZoom)return;const{offsetX:n}=s;s.start(t),x=o.moveX,I=o.moveY,$=Date.now(),W=!1,o.moving=h===1&&o.scale!==1,o.zooming=h===2&&!n.value,o.zooming&&(b=o.scale,i=j(a))},Q=t=>{const{touches:a}=t;if(s.move(t),o.moving){const{deltaX:n,deltaY:u}=s,c=n.value+x,w=u.value+I;if((c>m.value||c<-m.value)&&!W&&s.isHorizontal()){o.moving=!1;return}W=!0,E(t,!0),o.moveX=P(c,-m.value,m.value),o.moveY=P(w,-f.value,f.value)}if(o.zooming&&(E(t,!0),a.length===2)){const n=j(a),u=b*n/i;g=Te(a),p(u,g)}},J=()=>{if(h>1)return;const{offsetX:t,offsetY:a}=s,n=Date.now()-$,u=250,c=5;t.value<c&&a.value<c&&(n<u?r?(clearTimeout(r),r=null,N()):r=setTimeout(()=>{l("close"),r=null},u):n>Ie&&l("longPress"))},k=t=>{let a=!1;if((o.moving||o.zooming)&&(a=!0,o.moving&&x===o.moveX&&I===o.moveY&&(a=!1),!t.touches.length)){o.zooming&&(o.moveX=P(o.moveX,-m.value,m.value),o.moveY=P(o.moveY,-f.value,f.value),o.zooming=!1),o.moving=!1,x=0,I=0,b=1,o.scale<1&&T();const n=+e.maxZoom;o.scale>n&&p(n,g)}E(t,a),J(),s.reset()},ee=t=>{const{naturalWidth:a,naturalHeight:n}=t.target;o.imageRatio=n/a};return Y(()=>e.active,T),Y(()=>e.show,t=>{t||T()}),ne("touchmove",Q,{target:X(()=>{var t;return(t=Z.value)==null?void 0:t.$el})}),()=>{const t={loading:()=>d(Pe,{type:"spinner"},null)};return d(ve,{ref:Z,class:A("swipe-item"),onTouchstartPassive:K,onTouchend:k,onTouchcancel:k},{default:()=>[v.image?d("div",{class:A("image-wrap")},[v.image({src:e.src})]):d(we,{ref:y,src:e.src,fit:"contain",class:A("image",{vertical:S.value}),style:H.value,onLoad:ee},t)]})}}});function Ye(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!pe(e)}const[Ze,C]=F("image-preview"),He=["show","teleport","transition","overlayStyle","closeOnPopstate"],Re={show:Boolean,loop:D,images:xe(),minZoom:M(1/3),maxZoom:M(3),overlay:D,closeable:Boolean,showIndex:D,className:B,closeIcon:L("clear"),transition:String,beforeClose:Function,overlayClass:B,overlayStyle:Object,swipeDuration:M(300),startPosition:M(0),showIndicators:Boolean,closeOnPopstate:D,closeIconPosition:L("top-right"),teleport:[String,Object]},De=U({name:Ze,props:Re,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:l,slots:v}){const o=_(),s=V({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),y=()=>{if(o.value){const i=q(o.value.$el);s.rootWidth=i.width,s.rootHeight=i.height,o.value.resize()}},Z=i=>l("scale",i),S=i=>l("update:show",i),H=()=>{Ce(e.beforeClose,{args:[s.active],done:()=>S(!1)})},m=i=>{i!==s.active&&(s.active=i,l("change",i))},f=()=>{if(e.showIndex)return d("div",{class:C("index")},[v.index?v.index({index:s.active}):`${s.active+1} / ${e.images.length}`])},p=()=>{if(v.cover)return d("div",{class:C("cover")},[v.cover()])},T=()=>{s.disableZoom=!0},N=()=>{s.disableZoom=!1},h=()=>{let i;return d(ge,{ref:o,lazyRender:!0,loop:e.loop,class:C("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:m,onDragEnd:N,onDragStart:T},Ye(i=e.images.map((g,r)=>d(Xe,{src:g,show:e.show,active:s.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:s.rootWidth,rootHeight:s.rootHeight,disableZoom:s.disableZoom,onScale:Z,onClose:H,onLongPress:()=>l("longPress",{index:r})},{image:v.image})))?i:{default:()=>[i]})},x=()=>{if(e.closeable)return d(de,{role:"button",name:e.closeIcon,class:[C("close-icon",e.closeIconPosition),be],onClick:H},null)},I=()=>l("closed"),b=(i,g)=>{var r;return(r=o.value)==null?void 0:r.swipeTo(i,g)};return ue({swipeTo:b}),ye(y),Y([ie,le],y),Y(()=>e.startPosition,i=>m(+i)),Y(()=>e.show,i=>{const{images:g,startPosition:r}=e;i?(m(+r),Se(()=>{y(),b(+r,{immediate:!0})})):l("close",{index:s.active,url:g[s.active]})}),()=>d(fe,G({class:[C(),e.className],overlayClass:[C("overlay"),e.overlayClass],onClosed:I,"onUpdate:show":S},re(e,He)),{default:()=>[x(),h(),f(),p()]})}});let z;const Me={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function ze(){({instance:z}=ae({setup(){const{state:e,toggle:l}=se(),v=()=>{e.images=[]};return()=>d(De,G(e,{onClosed:v,"onUpdate:show":l}),null)}}))}const Ue=(e,l=0)=>{if(ce)return z||ze(),e=Array.isArray(e)?{images:e,startPosition:l}:e,z.open(me({},Me,e)),z};export{De as _,Ue as s};
