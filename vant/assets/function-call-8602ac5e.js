import{m as le,u as ce}from"./mount-component-d345efc2.js";import{n as re,c as G,l as $,H as y,s as K,w as me,r as ue,p as ve,d as ge,e as de}from"./use-translate-1ddc661f.js";import{u as fe}from"./use-expose-31cbee35.js";import{I as he}from"./index-c20ef9f4.js";import{a as we,S as Pe}from"./index-51c79983.js";import{P as Ie}from"./index-e84ecee9.js";import{u as Se}from"./use-touch-093d9c5b.js";import{I as xe}from"./index-f3d8a1a7.js";import{L as ye}from"./index-c254561f.js";import{A as Q,H as J,y as Z,D as H,u as Y,e as m,M as be,q as Ce,B as ee,Q as pe}from"./vue-libs-57cd1a95.js";import{d as D,n as j,t as M,b as Te,c as z,u as F,m as q}from"./with-install-4ceae99b.js";import{L as Ye,H as Xe}from"./constant-a81ffd37.js";import{c as Ze}from"./interceptor-96754bdd.js";const U=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),Re=e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}),k=G("image-preview")[1],V=2.6,He=Q({props:{src:String,show:Boolean,active:Number,minZoom:D(j),maxZoom:D(j),rootWidth:D(Number),rootHeight:D(Number),disableZoom:Boolean},emits:["scale","close","longPress"],setup(e,{emit:c,slots:u}){const o=J({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0}),s=Se(),b=Z(),R=Z(),w=Z(!1),d=Z(!1);let P=0;const W=H(()=>{const{scale:t,moveX:a,moveY:i,moving:l,zooming:r}=o,x={transitionDuration:r||l?"0s":".3s"};return(t!==1||d.value)&&(x.transform=`matrix(${t}, 0, 0, ${t}, ${a}, ${i})`),x}),v=H(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:a}=e,i=w.value?a/o.imageRatio:t;return Math.max(0,(o.scale*i-t)/2)}return 0}),h=H(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:a}=e,i=w.value?a:t*o.imageRatio;return Math.max(0,(o.scale*i-a)/2)}return 0}),C=(t,a)=>{var i;if(t=y(t,+e.minZoom,+e.maxZoom+1),t!==o.scale){const l=t/o.scale;if(o.scale=t,a){const r=K((i=b.value)==null?void 0:i.$el),x={x:r.width*.5,y:r.height*.5},ne=o.moveX-(a.x-r.left-x.x)*(l-1),ie=o.moveY-(a.y-r.top-x.y)*(l-1);o.moveX=y(ne,-v.value,v.value),o.moveY=y(ie,-h.value,h.value)}else o.moveX=0,o.moveY=d.value?P:0;c("scale",{scale:t,index:e.active})}},p=()=>{C(1)},E=()=>{const t=o.scale>1?1:2;C(t,t===2||d.value?{x:s.startX.value,y:s.startY.value}:void 0)};let I,S,n,f,g,A,X,L,_=!1;const oe=t=>{const{touches:a}=t;if(I=a.length,I===2&&e.disableZoom)return;const{offsetX:i}=s;s.start(t),S=o.moveX,n=o.moveY,L=Date.now(),_=!1,o.moving=I===1&&(o.scale!==1||d.value),o.zooming=I===2&&!i.value,o.zooming&&(f=o.scale,g=U(a))},te=t=>{const{touches:a}=t;if(s.move(t),o.moving){const{deltaX:i,deltaY:l}=s,r=i.value+S,x=l.value+n;if((r>v.value||r<-v.value)&&!_&&s.isHorizontal()){o.moving=!1;return}_=!0,$(t,!0),o.moveX=y(r,-v.value,v.value),o.moveY=y(x,-h.value,h.value)}if(o.zooming&&($(t,!0),a.length===2)){const i=U(a),l=f*i/g;A=Re(a),C(l,A)}},ae=()=>{if(I>1)return;const{offsetX:t,offsetY:a}=s,i=Date.now()-L,l=250,r=5;t.value<r&&a.value<r&&(i<l?X?(clearTimeout(X),X=null,E()):X=setTimeout(()=>{c("close"),X=null},l):i>Ye&&c("longPress"))},O=t=>{let a=!1;if((o.moving||o.zooming)&&(a=!0,o.moving&&S===o.moveX&&n===o.moveY&&(a=!1),!t.touches.length)){o.zooming&&(o.moveX=y(o.moveX,-v.value,v.value),o.moveY=y(o.moveY,-h.value,h.value),o.zooming=!1),o.moving=!1,S=0,n=0,f=1,o.scale<1&&p();const i=+e.maxZoom;o.scale>i&&C(i,A)}$(t,a),ae(),s.reset()},B=()=>{const{rootWidth:t,rootHeight:a}=e,i=a/t,{imageRatio:l}=o;w.value=o.imageRatio>i&&l<V,d.value=o.imageRatio>i&&l>=V,d.value&&(P=(l*t-a)/2,o.moveY=P),p()},se=t=>{const{naturalWidth:a,naturalHeight:i}=t.target;o.imageRatio=i/a,B()};return Y(()=>e.active,p),Y(()=>e.show,t=>{t||p()}),Y(()=>[e.rootWidth,e.rootHeight],B),re("touchmove",te,{target:H(()=>{var t;return(t=R.value)==null?void 0:t.$el})}),()=>{const t={loading:()=>m(ye,{type:"spinner"},null)};return m(we,{ref:R,class:k("swipe-item"),onTouchstartPassive:oe,onTouchend:O,onTouchcancel:O},{default:()=>[u.image?m("div",{class:k("image-wrap")},[u.image({src:e.src})]):m(xe,{ref:b,src:e.src,fit:"contain",class:k("image",{vertical:w.value}),style:W.value,onLoad:se},t)]})}}});function De(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!pe(e)}const[Me,T]=G("image-preview"),ze=["show","teleport","transition","overlayStyle","closeOnPopstate"],Ne={show:Boolean,loop:M,images:Te(),minZoom:z(1/3),maxZoom:z(3),overlay:M,closeable:Boolean,showIndex:M,className:F,closeIcon:q("clear"),transition:String,beforeClose:Function,overlayClass:F,overlayStyle:Object,swipeDuration:z(300),startPosition:z(0),showIndicators:Boolean,closeOnPopstate:M,closeIconPosition:q("top-right"),teleport:[String,Object]},We=Q({name:Me,props:Ne,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:c,slots:u}){const o=Z(),s=J({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),b=()=>{if(o.value){const n=K(o.value.$el);s.rootWidth=n.width,s.rootHeight=n.height,o.value.resize()}},R=n=>c("scale",n),w=n=>c("update:show",n),d=()=>{Ze(e.beforeClose,{args:[s.active],done:()=>w(!1)})},P=n=>{n!==s.active&&(s.active=n,c("change",n))},W=()=>{if(e.showIndex)return m("div",{class:T("index")},[u.index?u.index({index:s.active}):`${s.active+1} / ${e.images.length}`])},v=()=>{if(u.cover)return m("div",{class:T("cover")},[u.cover()])},h=()=>{s.disableZoom=!0},C=()=>{s.disableZoom=!1},p=()=>{let n;return m(Pe,{ref:o,lazyRender:!0,loop:e.loop,class:T("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:P,onDragEnd:C,onDragStart:h},De(n=e.images.map((f,g)=>m(He,{src:f,show:e.show,active:s.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:s.rootWidth,rootHeight:s.rootHeight,disableZoom:s.disableZoom,onScale:R,onClose:d,onLongPress:()=>c("longPress",{index:g})},{image:u.image})))?n:{default:()=>[n]})},E=()=>{if(e.closeable)return m(he,{role:"button",name:e.closeIcon,class:[T("close-icon",e.closeIconPosition),Xe],onClick:d},null)},I=()=>c("closed"),S=(n,f)=>{var g;return(g=o.value)==null?void 0:g.swipeTo(n,f)};return fe({swipeTo:S}),be(b),Y([me,ue],b),Y(()=>e.startPosition,n=>P(+n)),Y(()=>e.show,n=>{const{images:f,startPosition:g}=e;n?(P(+g),Ce(()=>{b(),S(+g,{immediate:!0})})):c("close",{index:s.active,url:f[s.active]})}),()=>m(Ie,ee({class:[T(),e.className],overlayClass:[T("overlay"),e.overlayClass],onClosed:I,"onUpdate:show":w},ve(e,ze)),{default:()=>[E(),p(),W(),v()]})}});let N;const Ee={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function Ae(){({instance:N}=le({setup(){const{state:e,toggle:c}=ce(),u=()=>{e.images=[]};return()=>m(We,ee(e,{onClosed:u,"onUpdate:show":c}),null)}}))}const Qe=(e,c=0)=>{if(ge)return N||Ae(),e=Array.isArray(e)?{images:e,startPosition:c}:e,N.open(de({},Ee,e)),N};export{We as _,Qe as s};
