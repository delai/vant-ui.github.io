import{m as J,u as ee}from"./mount-component-23f5a3b8.js";import{n as oe,c as $,l as A,H as C,w as te,r as ae,p as se,s as ne,d as ie,e as ce}from"./use-translate-bcc9285c.js";import{u as re}from"./use-expose-52ca271b.js";import{I as le}from"./index-13130ea7.js";import{a as me,S as ue}from"./index-48ea421e.js";import{P as de}from"./index-4a7db624.js";import{u as ge}from"./use-touch-8f92051d.js";import{I as ve}from"./index-9a949c16.js";import{L as fe}from"./index-2bd2daba.js";import{A as L,H as B,u as j,D as T,x as b,e as l,M as he,q as we,B as F,Q as Pe}from"./vue-libs-b2a2f6f9.js";import{d as H,n as _,t as R,b as pe,c as Z,u as k,m as E}from"./with-install-c0de7835.js";import{L as Se,H as Ie}from"./constant-a81ffd37.js";import{c as xe}from"./interceptor-e1e3c393.js";const O=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),N=$("image-preview")[1],ye=L({props:{src:String,show:Boolean,active:Number,minZoom:H(_),maxZoom:H(_),rootWidth:H(Number),rootHeight:H(Number)},emits:["scale","close","longPress"],setup(e,{emit:c,slots:m}){const o=B({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),n=ge(),h=j(),I=T(()=>{const{rootWidth:t,rootHeight:s}=e,i=s/t;return o.imageRatio>i}),X=T(()=>{const{scale:t,moveX:s,moveY:i,moving:g,zooming:p}=o,Y={transitionDuration:p||g?"0s":".3s"};if(t!==1){const K=s/t,Q=i/t;Y.transform=`scale(${t}, ${t}) translate(${K}px, ${Q}px)`}return Y}),v=T(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:s}=e,i=I.value?s/o.imageRatio:t;return Math.max(0,(o.scale*i-t)/2)}return 0}),u=T(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:s}=e,i=I.value?s:t*o.imageRatio;return Math.max(0,(o.scale*i-s)/2)}return 0}),x=t=>{t=C(t,+e.minZoom,+e.maxZoom+1),t!==o.scale&&(o.scale=t,c("scale",{scale:t,index:e.active}))},y=()=>{x(1),o.moveX=0,o.moveY=0},M=()=>{const t=o.scale>1?1:2;x(t),o.moveX=0,o.moveY=0};let w,P,f,a,d,r,W;const q=t=>{const{touches:s}=t,{offsetX:i}=n;n.start(t),w=s.length,P=o.moveX,f=o.moveY,W=Date.now(),o.moving=w===1&&o.scale!==1,o.zooming=w===2&&!i.value,o.zooming&&(a=o.scale,d=O(t.touches))},U=t=>{const{touches:s}=t;if(n.move(t),(o.moving||o.zooming)&&A(t,!0),o.moving){const{deltaX:i,deltaY:g}=n,p=i.value+P,Y=g.value+f;o.moveX=C(p,-v.value,v.value),o.moveY=C(Y,-u.value,u.value)}if(o.zooming&&s.length===2){const i=O(s),g=a*i/d;x(g)}},V=()=>{if(w>1)return;const{offsetX:t,offsetY:s}=n,i=Date.now()-W,g=250,p=5;t.value<p&&s.value<p&&(i<g?r?(clearTimeout(r),r=null,M()):r=setTimeout(()=>{c("close"),r=null},g):i>Se&&c("longPress"))},D=t=>{let s=!1;(o.moving||o.zooming)&&(s=!0,o.moving&&P===o.moveX&&f===o.moveY&&(s=!1),t.touches.length||(o.zooming&&(o.moveX=C(o.moveX,-v.value,v.value),o.moveY=C(o.moveY,-u.value,u.value),o.zooming=!1),o.moving=!1,P=0,f=0,a=1,o.scale<1&&y(),o.scale>e.maxZoom&&(o.scale=+e.maxZoom))),A(t,s),V(),n.reset()},G=t=>{const{naturalWidth:s,naturalHeight:i}=t.target;o.imageRatio=i/s};return b(()=>e.active,y),b(()=>e.show,t=>{t||y()}),oe("touchmove",U,{target:T(()=>{var t;return(t=h.value)==null?void 0:t.$el})}),()=>{const t={loading:()=>l(fe,{type:"spinner"},null)};return l(me,{ref:h,class:N("swipe-item"),onTouchstartPassive:q,onTouchend:D,onTouchcancel:D},{default:()=>[m.image?l("div",{class:N("image-wrap")},[m.image({src:e.src})]):l(ve,{src:e.src,fit:"contain",class:N("image",{vertical:I.value}),style:X.value,onLoad:G},t)]})}}});function Ce(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Pe(e)}const[Te,S]=$("image-preview"),be=["show","transition","overlayStyle","closeOnPopstate","teleport"],Xe={show:Boolean,loop:R,images:pe(),minZoom:Z(1/3),maxZoom:Z(3),overlay:R,closeable:Boolean,showIndex:R,className:k,closeIcon:E("clear"),transition:String,beforeClose:Function,overlayClass:k,overlayStyle:Object,swipeDuration:Z(300),startPosition:Z(0),showIndicators:Boolean,closeOnPopstate:R,closeIconPosition:E("top-right"),teleport:[String,Object]},Ye=L({name:Te,props:Xe,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:c,slots:m}){const o=j(),n=B({active:0,rootWidth:0,rootHeight:0}),h=()=>{if(o.value){const a=ne(o.value.$el);n.rootWidth=a.width,n.rootHeight=a.height,o.value.resize()}},I=a=>c("scale",a),X=a=>c("update:show",a),v=()=>{xe(e.beforeClose,{args:[n.active],done:()=>X(!1)})},u=a=>{a!==n.active&&(n.active=a,c("change",a))},x=()=>{if(e.showIndex)return l("div",{class:S("index")},[m.index?m.index({index:n.active}):`${n.active+1} / ${e.images.length}`])},y=()=>{if(m.cover)return l("div",{class:S("cover")},[m.cover()])},M=()=>{let a;return l(ue,{ref:o,lazyRender:!0,loop:e.loop,class:S("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:u},Ce(a=e.images.map((d,r)=>l(ye,{src:d,show:e.show,active:n.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:n.rootWidth,rootHeight:n.rootHeight,onScale:I,onClose:v,onLongPress:()=>c("longPress",{index:r})},{image:m.image})))?a:{default:()=>[a]})},w=()=>{if(e.closeable)return l(le,{role:"button",name:e.closeIcon,class:[S("close-icon",e.closeIconPosition),Ie],onClick:v},null)},P=()=>c("closed"),f=(a,d)=>{var r;return(r=o.value)==null?void 0:r.swipeTo(a,d)};return re({swipeTo:f}),he(h),b([te,ae],h),b(()=>e.startPosition,a=>u(+a)),b(()=>e.show,a=>{const{images:d,startPosition:r}=e;a?(u(+r),we(()=>{h(),f(+r,{immediate:!0})})):c("close",{index:n.active,url:d[n.active]})}),()=>l(de,F({class:[S(),e.className],overlayClass:[S("overlay"),e.overlayClass],onClosed:P,"onUpdate:show":X},se(e,be)),{default:()=>[w(),M(),x(),y()]})}});let z;const He={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function Re(){({instance:z}=J({setup(){const{state:e,toggle:c}=ee(),m=()=>{e.images=[]};return()=>l(Ye,F(e,{onClosed:m,"onUpdate:show":c}),null)}}))}const Be=(e,c=0)=>{if(ie)return z||Re(),e=Array.isArray(e)?{images:e,startPosition:c}:e,z.open(ce({},He,e)),z};export{Ye as _,Be as s};
