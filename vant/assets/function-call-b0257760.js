import{m as ee,u as oe}from"./mount-component-23f5a3b8.js";import{n as te,c as B,l as z,H as T,w as ae,r as se,p as ne,s as ie,d as ce,e as le}from"./use-translate-bcc9285c.js";import{u as re}from"./use-expose-52ca271b.js";import{I as me}from"./index-13130ea7.js";import{a as ue,S as de}from"./index-ce56f8fe.js";import{P as ge}from"./index-4a7db624.js";import{u as fe}from"./use-touch-8f92051d.js";import{I as ve}from"./index-9a949c16.js";import{L as he}from"./index-2bd2daba.js";import{A as L,H as j,u as F,D as Z,x as X,e as r,M as we,q as Pe,B as q,Q as Se}from"./vue-libs-b2a2f6f9.js";import{d as D,n as _,t as R,b as pe,c as M,u as k,m as O}from"./with-install-c0de7835.js";import{L as Ie,H as xe}from"./constant-a81ffd37.js";import{c as be}from"./interceptor-e1e3c393.js";const $=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),E=B("image-preview")[1],ye=L({props:{src:String,show:Boolean,active:Number,minZoom:D(_),maxZoom:D(_),rootWidth:D(Number),rootHeight:D(Number),disableZoom:Boolean},emits:["scale","close","longPress"],setup(e,{emit:c,slots:m}){const o=j({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),s=fe(),w=F(),I=Z(()=>{const{rootWidth:t,rootHeight:n}=e,i=n/t;return o.imageRatio>i}),Y=Z(()=>{const{scale:t,moveX:n,moveY:i,moving:f,zooming:v}=o,H={transitionDuration:v||f?"0s":".3s"};if(t!==1){const Q=n/t,J=i/t;H.transform=`scale(${t}, ${t}) translate(${Q}px, ${J}px)`}return H}),u=Z(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:n}=e,i=I.value?n/o.imageRatio:t;return Math.max(0,(o.scale*i-t)/2)}return 0}),d=Z(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:n}=e,i=I.value?n:t*o.imageRatio;return Math.max(0,(o.scale*i-n)/2)}return 0}),x=t=>{t=T(t,+e.minZoom,+e.maxZoom+1),t!==o.scale&&(o.scale=t,c("scale",{scale:t,index:e.active}))},b=()=>{x(1),o.moveX=0,o.moveY=0},W=()=>{const t=o.scale>1?1:2;x(t),o.moveX=0,o.moveY=0};let h,P,S,y,C,a,g,l=!1;const U=t=>{const{touches:n}=t;if(h=n.length,h===2&&e.disableZoom)return;const{offsetX:i}=s;s.start(t),P=o.moveX,S=o.moveY,g=Date.now(),l=!1,o.moving=h===1&&o.scale!==1,o.zooming=h===2&&!i.value,o.zooming&&(y=o.scale,C=$(t.touches))},V=t=>{const{touches:n}=t;if(s.move(t),o.moving){const{deltaX:i,deltaY:f}=s,v=i.value+P,H=f.value+S;if((v>u.value||v<-u.value)&&!l){o.moving=!1;return}l=!0,z(t,!0),o.moveX=T(v,-u.value,u.value),o.moveY=T(H,-d.value,d.value)}if(o.zooming&&(z(t,!0),n.length===2)){const i=$(n),f=y*i/C;x(f)}},G=()=>{if(h>1)return;const{offsetX:t,offsetY:n}=s,i=Date.now()-g,f=250,v=5;t.value<v&&n.value<v&&(i<f?a?(clearTimeout(a),a=null,W()):a=setTimeout(()=>{c("close"),a=null},f):i>Ie&&c("longPress"))},A=t=>{let n=!1;(o.moving||o.zooming)&&(n=!0,o.moving&&P===o.moveX&&S===o.moveY&&(n=!1),t.touches.length||(o.zooming&&(o.moveX=T(o.moveX,-u.value,u.value),o.moveY=T(o.moveY,-d.value,d.value),o.zooming=!1),o.moving=!1,P=0,S=0,y=1,o.scale<1&&b(),o.scale>e.maxZoom&&(o.scale=+e.maxZoom))),z(t,n),G(),s.reset()},K=t=>{const{naturalWidth:n,naturalHeight:i}=t.target;o.imageRatio=i/n};return X(()=>e.active,b),X(()=>e.show,t=>{t||b()}),te("touchmove",V,{target:Z(()=>{var t;return(t=w.value)==null?void 0:t.$el})}),()=>{const t={loading:()=>r(he,{type:"spinner"},null)};return r(ue,{ref:w,class:E("swipe-item"),onTouchstartPassive:U,onTouchend:A,onTouchcancel:A},{default:()=>[m.image?r("div",{class:E("image-wrap")},[m.image({src:e.src})]):r(ve,{src:e.src,fit:"contain",class:E("image",{vertical:I.value}),style:Y.value,onLoad:K},t)]})}}});function Ce(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Se(e)}const[Te,p]=B("image-preview"),Ze=["show","teleport","transition","overlayStyle","closeOnPopstate"],Xe={show:Boolean,loop:R,images:pe(),minZoom:M(1/3),maxZoom:M(3),overlay:R,closeable:Boolean,showIndex:R,className:k,closeIcon:O("clear"),transition:String,beforeClose:Function,overlayClass:k,overlayStyle:Object,swipeDuration:M(300),startPosition:M(0),showIndicators:Boolean,closeOnPopstate:R,closeIconPosition:O("top-right"),teleport:[String,Object]},Ye=L({name:Te,props:Xe,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:c,slots:m}){const o=F(),s=j({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),w=()=>{if(o.value){const a=ie(o.value.$el);s.rootWidth=a.width,s.rootHeight=a.height,o.value.resize()}},I=a=>c("scale",a),Y=a=>c("update:show",a),u=()=>{be(e.beforeClose,{args:[s.active],done:()=>Y(!1)})},d=a=>{a!==s.active&&(s.active=a,c("change",a))},x=()=>{if(e.showIndex)return r("div",{class:p("index")},[m.index?m.index({index:s.active}):`${s.active+1} / ${e.images.length}`])},b=()=>{if(m.cover)return r("div",{class:p("cover")},[m.cover()])},W=()=>{s.disableZoom=!0},h=()=>{s.disableZoom=!1},P=()=>{let a;return r(de,{ref:o,lazyRender:!0,loop:e.loop,class:p("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:d,onDragEnd:h,onDragStart:W},Ce(a=e.images.map((g,l)=>r(ye,{src:g,show:e.show,active:s.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:s.rootWidth,rootHeight:s.rootHeight,disableZoom:s.disableZoom,onScale:I,onClose:u,onLongPress:()=>c("longPress",{index:l})},{image:m.image})))?a:{default:()=>[a]})},S=()=>{if(e.closeable)return r(me,{role:"button",name:e.closeIcon,class:[p("close-icon",e.closeIconPosition),xe],onClick:u},null)},y=()=>c("closed"),C=(a,g)=>{var l;return(l=o.value)==null?void 0:l.swipeTo(a,g)};return re({swipeTo:C}),we(w),X([ae,se],w),X(()=>e.startPosition,a=>d(+a)),X(()=>e.show,a=>{const{images:g,startPosition:l}=e;a?(d(+l),Pe(()=>{w(),C(+l,{immediate:!0})})):c("close",{index:s.active,url:g[s.active]})}),()=>r(ge,q({class:[p(),e.className],overlayClass:[p("overlay"),e.overlayClass],onClosed:y,"onUpdate:show":Y},ne(e,Ze)),{default:()=>[S(),P(),x(),b()]})}});let N;const He={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function De(){({instance:N}=ee({setup(){const{state:e,toggle:c}=oe(),m=()=>{e.images=[]};return()=>r(Ye,q(e,{onClosed:m,"onUpdate:show":c}),null)}}))}const je=(e,c=0)=>{if(ce)return N||De(),e=Array.isArray(e)?{images:e,startPosition:c}:e,N.open(le({},He,e)),N};export{Ye as _,je as s};
