import{L,I as N,u as g,A as j,y as T,D as F,q as H,M,J as V,P as G,e as v,S as U,F as Y,T as $,j as q,v as J,B as W}from"./vue-libs-6a67f9c6.js";import{n as A,t as O,u as Z,m as b,w as Q}from"./with-install-3eab31d5.js";import{o as X,m as ee,l as oe,i as ne,n as te,e as ae,c as se}from"./use-translate-982dff2e.js";import{u as ce}from"./use-expose-1bc17a0b.js";import{u as re}from"./use-touch-87b155f0.js";import{u as le}from"./use-lazy-render-7199096a.js";import{P as ie}from"./on-popup-reopen-2b57f4ff.js";import{u as ue,I as de}from"./index-e4434a2e.js";import{O as fe}from"./index-bef8ed4f.js";import{c as ve}from"./interceptor-5aa62d1f.js";import{H as me}from"./constant-00b7fd44.js";const D={show:Boolean,zIndex:A,overlay:O,duration:A,teleport:[String,Object],lockScroll:O,lazyRender:O,beforeClose:Function,overlayStyle:Object,overlayClass:Z,transitionAppear:Boolean,closeOnClickOverlay:O},Le=Object.keys(D);let y=0;const B="van-overflow-hidden";function ye(e,n){const s=re(),u="01",t="10",l=c=>{s.move(c);const f=s.deltaY.value>0?t:u,C=ee(c.target,e.value),{scrollHeight:m,offsetHeight:I,scrollTop:h}=C;let r="11";h===0?r=I>=m?"00":"01":h+I>=m&&(r="10"),r!=="11"&&s.isVertical()&&!(parseInt(r,2)&parseInt(f,2))&&oe(c,!0)},d=()=>{document.addEventListener("touchstart",s.start),document.addEventListener("touchmove",l,{passive:!1}),y||document.body.classList.add(B),y++},i=()=>{y&&(document.removeEventListener("touchstart",s.start),document.removeEventListener("touchmove",l),y--,y||document.body.classList.remove(B))},P=()=>n()&&d(),p=()=>n()&&i();X(P),L(p),N(p),g(n,c=>{c?d():i()})}const pe=ae({},D,{round:Boolean,position:b("center"),closeIcon:b("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:b("top-right"),safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[Ie,E]=se("popup"),he=j({name:Ie,inheritAttrs:!1,props:pe,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:n,attrs:s,slots:u}){let t,l;const d=T(),i=T(),P=le(()=>e.show||!e.lazyRender),p=F(()=>{const o={zIndex:d.value};if(ne(e.duration)){const a=e.position==="center"?"animationDuration":"transitionDuration";o[a]=`${e.duration}s`}return o}),c=()=>{t||(t=!0,d.value=e.zIndex!==void 0?+e.zIndex:ue(),n("open"))},f=()=>{t&&ve(e.beforeClose,{done(){t=!1,n("close"),n("update:show",!1)}})},C=o=>{n("clickOverlay",o),e.closeOnClickOverlay&&f()},m=()=>{if(e.overlay)return v(fe,{show:e.show,class:e.overlayClass,zIndex:d.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0,onClick:C},{default:u["overlay-content"]})},I=o=>{n("clickCloseIcon",o),f()},h=()=>{if(e.closeable)return v(de,{role:"button",tabindex:0,name:e.closeIcon,class:[E("close-icon",e.closeIconPosition),me],classPrefix:e.iconPrefix,onClick:I},null)};let r;const z=()=>{r&&clearTimeout(r),r=setTimeout(()=>{n("opened")})},R=()=>n("closed"),_=o=>n("keydown",o),K=P(()=>{var S;const{round:o,position:a,safeAreaInsetTop:k,safeAreaInsetBottom:w}=e;return q(v("div",W({ref:i,style:p.value,role:"dialog",tabindex:0,class:[E({round:o,[a]:a}),{"van-safe-area-top":k,"van-safe-area-bottom":w}],onKeydown:_},s),[(S=u.default)==null?void 0:S.call(u),h()]),[[J,e.show]])}),x=()=>{const{position:o,transition:a,transitionAppear:k}=e,w=o==="center"?"van-fade":`van-popup-slide-${o}`;return v($,{name:a||w,appear:k,onAfterEnter:z,onAfterLeave:R},{default:K})};return g(()=>e.show,o=>{o&&!t&&(c(),s.tabindex===0&&H(()=>{var a;(a=i.value)==null||a.focus()})),!o&&t&&(t=!1,n("close"))}),ce({popupRef:i}),ye(i,()=>e.show&&e.lockScroll),te("popstate",()=>{e.closeOnPopstate&&(f(),l=!1)}),M(()=>{e.show&&c()}),V(()=>{l&&(n("update:show",!0),l=!1)}),L(()=>{e.show&&e.teleport&&(f(),l=!0)}),G(ie,()=>e.show),()=>e.teleport?v(U,{to:e.teleport},{default:()=>[m(),x()]}):v(Y,null,[m(),x()])}}),Oe=Q(he),ge=Oe;export{Oe as P,ge as V,Le as a,D as p};
