import{t as M,n as N,c as E,w as J}from"./with-install-5cd181dc.js";import{b as ue,w as re,r as ve,R as fe,n as he,c as K,O as W,Q as $,l as de,H as R,u as me}from"./use-translate-7ec0e456.js";import{u as we}from"./use-touch-2d22ae5a.js";import{u as Q}from"./use-expose-8d780f8a.js";import{o as ge}from"./on-popup-reopen-a0d16524.js";import{A as U,u as q,H as j,D as r,x as P,M as F,J as pe,L as ye,I as be,e as C,q as G}from"./vue-libs-a0ef9506.js";const[Z,z]=K("swipe"),Se={loop:M,width:N,height:N,vertical:Boolean,autoplay:E(0),duration:E(500),touchable:M,lazyRender:Boolean,initialSwipe:E(0),indicatorColor:String,showIndicators:M,stopPropagation:M},ee=Symbol(Z),Te=U({name:Z,props:Se,emits:["change"],setup(a,{emit:y,slots:f}){const l=q(),v=q(),e=j({rect:null,width:0,height:0,offset:0,active:0,swiping:!1}),u=we(),{children:d,linkChildren:O}=ue(ee),i=r(()=>d.length),c=r(()=>e[a.vertical?"height":"width"]),s=r(()=>a.vertical?u.deltaY.value:u.deltaX.value),m=r(()=>e.rect?(a.vertical?e.rect.height:e.rect.width)-c.value*i.value:0),k=r(()=>c.value?Math.ceil(Math.abs(m.value)/c.value):i.value),b=r(()=>i.value*c.value),I=r(()=>(e.active+i.value)%i.value),B=r(()=>{const t=a.vertical?"vertical":"horizontal";return u.direction.value===t}),te=r(()=>{const t={transitionDuration:`${e.swiping?0:a.duration}ms`,transform:`translate${a.vertical?"Y":"X"}(${e.offset}px)`};if(c.value){const o=a.vertical?"height":"width",n=a.vertical?"width":"height";t[o]=`${b.value}px`,t[n]=a[n]?`${a[n]}px`:""}return t}),ae=t=>{const{active:o}=e;return t?a.loop?R(o+t,-1,i.value):R(o+t,0,k.value):o},H=(t,o=0)=>{let n=t*c.value;a.loop||(n=Math.min(n,-m.value));let h=o-n;return a.loop||(h=R(h,m.value,0)),h},w=({pace:t=0,offset:o=0,emitChange:n})=>{if(i.value<=1)return;const{active:h}=e,g=ae(t),x=H(g,o);if(a.loop){if(d[0]&&x!==m.value){const D=x<m.value;d[0].setOffset(D?b.value:0)}if(d[i.value-1]&&x!==0){const D=x>0;d[i.value-1].setOffset(D?-b.value:0)}}e.active=g,e.offset=x,n&&g!==h&&y("change",I.value)},A=()=>{e.swiping=!0,e.active<=-1?w({pace:i.value}):e.active>=i.value&&w({pace:-i.value})},ie=()=>{A(),u.reset(),$(()=>{e.swiping=!1,w({pace:-1,emitChange:!0})})},V=()=>{A(),u.reset(),$(()=>{e.swiping=!1,w({pace:1,emitChange:!0})})};let Y;const S=()=>clearTimeout(Y),T=()=>{S(),a.autoplay>0&&i.value>1&&(Y=setTimeout(()=>{V(),T()},+a.autoplay))},p=(t=+a.initialSwipe)=>{if(!l.value)return;const o=()=>{if(!W(l)){const n={width:l.value.offsetWidth,height:l.value.offsetHeight};e.rect=n,e.width=+(a.width??n.width),e.height=+(a.height??n.height)}i.value&&(t=Math.min(i.value-1,t)),e.active=t,e.swiping=!0,e.offset=H(t),d.forEach(n=>{n.setOffset(0)}),T()};W(l)?G().then(o):o()},X=()=>p(e.active);let _;const ne=t=>{a.touchable&&(u.start(t),_=Date.now(),S(),A())},oe=t=>{a.touchable&&e.swiping&&(u.move(t),B.value&&(!a.loop&&(e.active===0&&s.value>0||e.active===i.value-1&&s.value<0)||(de(t,a.stopPropagation),w({offset:s.value}))))},L=()=>{if(!a.touchable||!e.swiping)return;const t=Date.now()-_,o=s.value/t;if((Math.abs(o)>.25||Math.abs(s.value)>c.value/2)&&B.value){const h=a.vertical?u.offsetY.value:u.offsetX.value;let g=0;a.loop?g=h>0?s.value>0?-1:1:0:g=-Math[s.value>0?"ceil":"floor"](s.value/c.value),w({pace:g,emitChange:!0})}else s.value&&w({pace:0});e.swiping=!1,T()},se=(t,o={})=>{A(),u.reset(),$(()=>{let n;a.loop&&t===i.value?n=e.active===0?0:t:n=t%i.value,o.immediate?$(()=>{e.swiping=!1}):e.swiping=!1,w({pace:n-e.active,emitChange:!0})})},ce=(t,o)=>{const n=o===I.value,h=n?{backgroundColor:a.indicatorColor}:void 0;return C("i",{style:h,class:z("indicator",{active:n})},null)},le=()=>{if(f.indicator)return f.indicator({active:I.value,total:i.value});if(a.showIndicators&&i.value>1)return C("div",{class:z("indicators",{vertical:a.vertical})},[Array(i.value).fill("").map(ce)])};return Q({prev:ie,next:V,state:e,resize:X,swipeTo:se}),O({size:c,props:a,count:i,activeIndicator:I}),P(()=>a.initialSwipe,t=>p(+t)),P(i,()=>p(e.active)),P(()=>a.autoplay,T),P([re,ve],X),P(fe(),t=>{t==="visible"?T():S()}),F(p),pe(()=>p(e.active)),ge(()=>p(e.active)),ye(S),be(S),he("touchmove",oe,{target:v}),()=>{var t;return C("div",{ref:l,class:z()},[C("div",{ref:v,style:te.value,class:z("track",{vertical:a.vertical}),onTouchstartPassive:ne,onTouchend:L,onTouchcancel:L},[(t=f.default)==null?void 0:t.call(f)]),le()])}}}),xe=J(Te),Ee=xe,[Pe,Ce]=K("swipe-item"),Ie=U({name:Pe,setup(a,{slots:y}){let f;const l=j({offset:0,inited:!1,mounted:!1}),{parent:v,index:e}=me(ee);if(!v)return;const u=r(()=>{const i={},{vertical:c}=v.props;return v.size.value&&(i[c?"height":"width"]=`${v.size.value}px`),l.offset&&(i.transform=`translate${c?"Y":"X"}(${l.offset}px)`),i}),d=r(()=>{const{loop:i,lazyRender:c}=v.props;if(!c||f)return!0;if(!l.mounted)return!1;const s=v.activeIndicator.value,m=v.count.value-1,k=s===0&&i?m:s-1,b=s===m&&i?0:s+1;return f=e.value===s||e.value===k||e.value===b,f}),O=i=>{l.offset=i};return F(()=>{G(()=>{l.mounted=!0})}),Q({setOffset:O}),()=>{var i;return C("div",{class:Ce(),style:u.value},[d.value?(i=y.default)==null?void 0:i.call(y):null])}}}),Ae=J(Ie),Re=Ae;export{xe as S,Ee as V,Ae as a,Re as b};
