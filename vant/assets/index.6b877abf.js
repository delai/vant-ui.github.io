import{o as _,m as j,l as F,e as H,c as M,i as N,n as Y}from"./use-translate.fbf36f21.js";import{n as x,t as w,u as G,m as C,w as U}from"./with-install.251697cd.js";import{M as g,J as V,x as z,z as $,D as S,C as q,q as J,N as Z,L as Q,I as W,e as f,T as X,R as ee,F as oe,j as te,v as ne,A as ae}from"./vue-libs.bf80eadf.js";import{H as se}from"./constant.80c6de18.js";import{c as ce}from"./interceptor.12fa8767.js";import{u as re}from"./use-expose.8d47dba2.js";import{u as le}from"./use-touch.9de12470.js";import{u as ie}from"./use-lazy-render.d79b7d1e.js";import{P as ue}from"./on-popup-reopen.e08ee506.js";import{I as de}from"./index.f1bbf430.js";import{O as fe}from"./index.c2caac4e.js";const B={show:Boolean,zIndex:x,overlay:w,duration:x,teleport:[String,Object],lockScroll:w,lazyRender:w,beforeClose:Function,overlayStyle:Object,overlayClass:G,transitionAppear:Boolean,closeOnClickOverlay:w},Le=Object.keys(B);let y=0;const b="van-overflow-hidden";function ve(e,t){const s=le(),c=i=>{s.move(i);const I=s.deltaY.value>0?"10":"01",p=j(i.target,e.value),{scrollHeight:u,offsetHeight:h,scrollTop:m}=p;let d="11";m===0?d=h>=u?"00":"01":m+h>=u&&(d="10"),d!=="11"&&s.isVertical()&&!(parseInt(d,2)&parseInt(I,2))&&F(i,!0)},n=()=>{document.addEventListener("touchstart",s.start),document.addEventListener("touchmove",c,{passive:!1}),y||document.body.classList.add(b),y++},r=()=>{y&&(document.removeEventListener("touchstart",s.start),document.removeEventListener("touchmove",c),y--,y||document.body.classList.remove(b))},v=()=>t()&&n(),l=()=>t()&&r();_(v),g(l),V(l),z(t,i=>{i?n():r()})}const me=H({},B,{round:Boolean,position:C("center"),closeIcon:C("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:C("top-right"),safeAreaInsetBottom:Boolean}),[ye,A]=M("popup");let L=2e3;var pe=$({name:ye,inheritAttrs:!1,props:me,emits:["open","close","opened","closed","keydown","update:show","click-overlay","click-close-icon"],setup(e,{emit:t,attrs:s,slots:c}){let n,r;const v=S(),l=S(),i=ie(()=>e.show||!e.lazyRender),I=q(()=>{const o={zIndex:v.value};if(N(e.duration)){const a=e.position==="center"?"animationDuration":"transitionDuration";o[a]=`${e.duration}s`}return o}),p=()=>{n||(e.zIndex!==void 0&&(L=+e.zIndex),n=!0,v.value=++L,t("open"))},u=()=>{n&&ce(e.beforeClose,{done(){n=!1,t("close"),t("update:show",!1)}})},h=o=>{t("click-overlay",o),e.closeOnClickOverlay&&u()},m=()=>{if(e.overlay)return f(fe,{show:e.show,class:e.overlayClass,zIndex:v.value,duration:e.duration,customStyle:e.overlayStyle,onClick:h},{default:c["overlay-content"]})},d=o=>{t("click-close-icon",o),u()},E=()=>{if(e.closeable)return f(de,{role:"button",tabindex:0,name:e.closeIcon,class:[A("close-icon",e.closeIconPosition),se],classPrefix:e.iconPrefix,onClick:d},null)},T=()=>t("opened"),D=()=>t("closed"),R=o=>t("keydown",o),K=i(()=>{var P;const{round:o,position:a,safeAreaInsetBottom:k}=e;return te(f("div",ae({ref:l,style:I.value,class:[A({round:o,[a]:a}),{"van-safe-area-bottom":k}],onKeydown:R},s),[(P=c.default)==null?void 0:P.call(c),E()]),[[ne,e.show]])}),O=()=>{const{position:o,transition:a,transitionAppear:k}=e,P=o==="center"?"van-fade":`van-popup-slide-${o}`;return f(X,{name:a||P,appear:k,onAfterEnter:T,onAfterLeave:D},{default:K})};return z(()=>e.show,o=>{o&&!n&&(p(),s.tabindex===0&&J(()=>{var a;(a=l.value)==null||a.focus()})),!o&&n&&(n=!1,t("close"))}),re({popupRef:l}),ve(l,()=>e.show&&e.lockScroll),Y("popstate",()=>{e.closeOnPopstate&&(u(),r=!1)}),Z(()=>{e.show&&p()}),Q(()=>{r&&(t("update:show",!0),r=!1)}),g(()=>{e.show&&(u(),r=!0)}),W(ue,()=>e.show),()=>e.teleport?f(ee,{to:e.teleport},{default:()=>[m(),O()]}):f(oe,null,[m(),O()])}});const ge=U(pe);export{ge as P,Le as a,B as p};
