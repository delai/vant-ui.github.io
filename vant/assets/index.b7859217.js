import{o as j,m as F,l as H,e as M,c as V,i as N,n as Y}from"./use-translate.8ba7ae4e.js";import{n as S,t as P,u as G,m as C,w as U}from"./with-install.1c49d2eb.js";import{M as B,J as $,x as T,z as q,C as b,D as J,q as Z,N as Q,L as W,I as X,e as f,T as ee,R as oe,F as te,j as ne,v as ae,A as se}from"./vue-libs.d483629c.js";import{H as ce}from"./constant.80c6de18.js";import{c as re}from"./interceptor.5ac8596d.js";import{u as le}from"./use-expose.30c76c17.js";import{u as ie}from"./use-touch.2a7e3be3.js";import{u as ue}from"./use-lazy-render.13317edf.js";import{P as de}from"./on-popup-reopen.27c65306.js";import{I as fe}from"./index.1d88bb58.js";import{O as ve}from"./index.76aa749c.js";const z={show:Boolean,zIndex:S,overlay:P,duration:S,teleport:[String,Object],lockScroll:P,lazyRender:P,beforeClose:Function,overlayStyle:Object,overlayClass:G,transitionAppear:Boolean,closeOnClickOverlay:P},Be=Object.keys(z);let p=0;const A="van-overflow-hidden";function me(e,t){const s=ie(),c=i=>{s.move(i);const I=s.deltaY.value>0?"10":"01",y=F(i.target,e.value),{scrollHeight:u,offsetHeight:h,scrollTop:m}=y;let d="11";m===0?d=h>=u?"00":"01":m+h>=u&&(d="10"),d!=="11"&&s.isVertical()&&!(parseInt(d,2)&parseInt(I,2))&&H(i,!0)},n=()=>{document.addEventListener("touchstart",s.start),document.addEventListener("touchmove",c,{passive:!1}),p||document.body.classList.add(A),p++},r=()=>{p&&(document.removeEventListener("touchstart",s.start),document.removeEventListener("touchmove",c),p--,p||document.body.classList.remove(A))},v=()=>t()&&n(),l=()=>t()&&r();j(v),B(l),$(l),T(t,i=>{i?n():r()})}const pe=M({},z,{round:Boolean,position:C("center"),closeIcon:C("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:C("top-right"),safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[ye,L]=V("popup");let g=2e3;const he=q({name:ye,inheritAttrs:!1,props:pe,emits:["open","close","opened","closed","keydown","update:show","click-overlay","click-close-icon"],setup(e,{emit:t,attrs:s,slots:c}){let n,r;const v=b(),l=b(),i=ue(()=>e.show||!e.lazyRender),I=J(()=>{const o={zIndex:v.value};if(N(e.duration)){const a=e.position==="center"?"animationDuration":"transitionDuration";o[a]=`${e.duration}s`}return o}),y=()=>{n||(e.zIndex!==void 0&&(g=+e.zIndex),n=!0,v.value=++g,t("open"))},u=()=>{n&&re(e.beforeClose,{done(){n=!1,t("close"),t("update:show",!1)}})},h=o=>{t("click-overlay",o),e.closeOnClickOverlay&&u()},m=()=>{if(e.overlay)return f(ve,{show:e.show,class:e.overlayClass,zIndex:v.value,duration:e.duration,customStyle:e.overlayStyle,onClick:h},{default:c["overlay-content"]})},d=o=>{t("click-close-icon",o),u()},E=()=>{if(e.closeable)return f(fe,{role:"button",tabindex:0,name:e.closeIcon,class:[L("close-icon",e.closeIconPosition),ce],classPrefix:e.iconPrefix,onClick:d},null)},D=()=>t("opened"),R=()=>t("closed"),K=o=>t("keydown",o),_=i(()=>{var x;const{round:o,position:a,safeAreaInsetTop:w,safeAreaInsetBottom:k}=e;return ne(f("div",se({ref:l,style:I.value,class:[L({round:o,[a]:a}),{"van-safe-area-top":w,"van-safe-area-bottom":k}],onKeydown:K},s),[(x=c.default)==null?void 0:x.call(c),E()]),[[ae,e.show]])}),O=()=>{const{position:o,transition:a,transitionAppear:w}=e,k=o==="center"?"van-fade":`van-popup-slide-${o}`;return f(ee,{name:a||k,appear:w,onAfterEnter:D,onAfterLeave:R},{default:_})};return T(()=>e.show,o=>{o&&!n&&(y(),s.tabindex===0&&Z(()=>{var a;(a=l.value)==null||a.focus()})),!o&&n&&(n=!1,t("close"))}),le({popupRef:l}),me(l,()=>e.show&&e.lockScroll),Y("popstate",()=>{e.closeOnPopstate&&(u(),r=!1)}),Q(()=>{e.show&&y()}),W(()=>{r&&(t("update:show",!0),r=!1)}),B(()=>{e.show&&e.teleport&&(u(),r=!0)}),X(de,()=>e.show),()=>e.teleport?f(oe,{to:e.teleport},{default:()=>[m(),O()]}):f(te,null,[m(),O()])}}),Pe=U(he),Te=Pe;export{Pe as P,Te as V,Be as a,z as p};
