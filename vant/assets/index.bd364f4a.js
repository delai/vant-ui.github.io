import{c as L,n as ee,l as A,H as C,w as oe,r as te,p as ae,s as se,d as ne,e as ie}from"./use-translate.a029ce72.js";import{m as ce,u as re}from"./mount-component.a9874ea3.js";import{A as O,H as B,u as j,D as T,x as b,e as l,M as le,q as me,B as F,Q as ue}from"./vue-libs.d5ee895a.js";import{d as H,n as k,t as R,b as de,c as Z,u as E,m as _,w as ge}from"./with-install.1dc27775.js";import{L as ve,H as fe}from"./constant.e12a51b9.js";import{c as he}from"./interceptor.2257d115.js";import{u as we}from"./use-expose.c6c7f4f7.js";import{I as Pe}from"./index.0a9aad73.js";import{a as Ie,S as pe}from"./index.6b625a87.js";import{P as Se}from"./index.61c0c549.js";import{u as xe}from"./use-touch.e8c4f7e8.js";import{I as ye}from"./index.75f65fda.js";import{L as Ce}from"./index.cacc54a3.js";const $=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),N=L("image-preview")[1],Te=O({props:{src:String,show:Boolean,active:Number,minZoom:H(k),maxZoom:H(k),rootWidth:H(Number),rootHeight:H(Number)},emits:["scale","close","longPress"],setup(e,{emit:c,slots:m}){const o=B({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),n=xe(),h=j(),S=T(()=>{const{rootWidth:t,rootHeight:s}=e,i=s/t;return o.imageRatio>i}),X=T(()=>{const{scale:t,moveX:s,moveY:i,moving:g,zooming:I}=o,Y={transitionDuration:I||g?"0s":".3s"};if(t!==1){const Q=s/t,J=i/t;Y.transform=`scale(${t}, ${t}) translate(${Q}px, ${J}px)`}return Y}),v=T(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:s}=e,i=S.value?s/o.imageRatio:t;return Math.max(0,(o.scale*i-t)/2)}return 0}),u=T(()=>{if(o.imageRatio){const{rootWidth:t,rootHeight:s}=e,i=S.value?s:t*o.imageRatio;return Math.max(0,(o.scale*i-s)/2)}return 0}),x=t=>{t=C(t,+e.minZoom,+e.maxZoom+1),t!==o.scale&&(o.scale=t,c("scale",{scale:t,index:e.active}))},y=()=>{x(1),o.moveX=0,o.moveY=0},M=()=>{const t=o.scale>1?1:2;x(t),o.moveX=0,o.moveY=0};let w,P,f,a,d,r,W;const U=t=>{const{touches:s}=t,{offsetX:i}=n;n.start(t),w=s.length,P=o.moveX,f=o.moveY,W=Date.now(),o.moving=w===1&&o.scale!==1,o.zooming=w===2&&!i.value,o.zooming&&(a=o.scale,d=$(t.touches))},V=t=>{const{touches:s}=t;if(n.move(t),(o.moving||o.zooming)&&A(t,!0),o.moving){const{deltaX:i,deltaY:g}=n,I=i.value+P,Y=g.value+f;o.moveX=C(I,-v.value,v.value),o.moveY=C(Y,-u.value,u.value)}if(o.zooming&&s.length===2){const i=$(s),g=a*i/d;x(g)}},G=()=>{if(w>1)return;const{offsetX:t,offsetY:s}=n,i=Date.now()-W,g=250,I=5;t.value<I&&s.value<I&&(i<g?r?(clearTimeout(r),r=null,M()):r=setTimeout(()=>{c("close"),r=null},g):i>ve&&c("longPress"))},D=t=>{let s=!1;(o.moving||o.zooming)&&(s=!0,o.moving&&P===o.moveX&&f===o.moveY&&(s=!1),t.touches.length||(o.zooming&&(o.moveX=C(o.moveX,-v.value,v.value),o.moveY=C(o.moveY,-u.value,u.value),o.zooming=!1),o.moving=!1,P=0,f=0,a=1,o.scale<1&&y(),o.scale>e.maxZoom&&(o.scale=+e.maxZoom))),A(t,s),G(),n.reset()},K=t=>{const{naturalWidth:s,naturalHeight:i}=t.target;o.imageRatio=i/s};return b(()=>e.active,y),b(()=>e.show,t=>{t||y()}),ee("touchmove",V,{target:T(()=>{var t;return(t=h.value)==null?void 0:t.$el})}),()=>{const t={loading:()=>l(Ce,{type:"spinner"},null)};return l(Ie,{ref:h,class:N("swipe-item"),onTouchstartPassive:U,onTouchend:D,onTouchcancel:D},{default:()=>[m.image?l("div",{class:N("image-wrap")},[m.image({src:e.src})]):l(ye,{src:e.src,fit:"contain",class:N("image",{vertical:S.value}),style:X.value,onLoad:K},t)]})}}});function be(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!ue(e)}const[Xe,p]=L("image-preview"),Ye=["show","transition","overlayStyle","closeOnPopstate"],He={show:Boolean,loop:R,images:de(),minZoom:Z(1/3),maxZoom:Z(3),overlay:R,closeable:Boolean,showIndex:R,className:E,closeIcon:_("clear"),transition:String,beforeClose:Function,overlayClass:E,overlayStyle:Object,swipeDuration:Z(300),startPosition:Z(0),showIndicators:Boolean,closeOnPopstate:R,closeIconPosition:_("top-right")},q=O({name:Xe,props:He,emits:["scale","close","closed","change","longPress","update:show"],setup(e,{emit:c,slots:m}){const o=j(),n=B({active:0,rootWidth:0,rootHeight:0}),h=()=>{if(o.value){const a=se(o.value.$el);n.rootWidth=a.width,n.rootHeight=a.height,o.value.resize()}},S=a=>c("scale",a),X=a=>c("update:show",a),v=()=>{he(e.beforeClose,{args:[n.active],done:()=>X(!1)})},u=a=>{a!==n.active&&(n.active=a,c("change",a))},x=()=>{if(e.showIndex)return l("div",{class:p("index")},[m.index?m.index({index:n.active}):`${n.active+1} / ${e.images.length}`])},y=()=>{if(m.cover)return l("div",{class:p("cover")},[m.cover()])},M=()=>{let a;return l(pe,{ref:o,lazyRender:!0,loop:e.loop,class:p("swipe"),duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:"white",onChange:u},be(a=e.images.map((d,r)=>l(Te,{src:d,show:e.show,active:n.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:n.rootWidth,rootHeight:n.rootHeight,onScale:S,onClose:v,onLongPress:()=>c("longPress",{index:r})},{image:m.image})))?a:{default:()=>[a]})},w=()=>{if(e.closeable)return l(Pe,{role:"button",name:e.closeIcon,class:[p("close-icon",e.closeIconPosition),fe],onClick:v},null)},P=()=>c("closed"),f=(a,d)=>{var r;return(r=o.value)==null?void 0:r.swipeTo(a,d)};return we({swipeTo:f}),le(h),b([oe,te],h),b(()=>e.startPosition,a=>u(+a)),b(()=>e.show,a=>{const{images:d,startPosition:r}=e;a?(u(+r),me(()=>{h(),f(+r,{immediate:!0})})):c("close",{index:n.active,url:d[n.active]})}),()=>l(Se,F({class:[p(),e.className],overlayClass:[p("overlay"),e.overlayClass],onClosed:P,"onUpdate:show":X},ae(e,Ye)),{default:()=>[w(),M(),x(),y()]})}});let z;const Re={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function Ze(){({instance:z}=ce({setup(){const{state:e,toggle:c}=re(),m=()=>{e.images=[]};return()=>l(q,F(e,{onClosed:m,"onUpdate:show":c}),null)}}))}const je=(e,c=0)=>{if(!!ne)return z||Ze(),e=Array.isArray(e)?{images:e,startPosition:c}:e,z.open(ie({},Re,e)),z},Fe=ge(q);export{Fe as I,je as s};
