import{c as U,i as N,U as j,Q as q,r as G,a as W}from"./use-translate.27860f70.js";import{t as D,b as M,m as S,c as X,w as V,d as ee,a as I}from"./with-install.8f167980.js";import{C as oe}from"./index.9633d8c1.js";import{A as _,e as o,D as m,x as g,y as F,M as ne,j as te,v as ae,q as se,r as ue,o as ce,c as ie,w as z,C}from"./vue-libs.73c42632.js";import{P as le}from"./index.e275e566.js";import{u as re}from"./use-refs.7352ad87.js";import{T as de,a as O}from"./index.793c279b.js";import{E as me}from"./index.af5f6b1d.js";import{F as pe}from"./index.9541ae01.js";import{B as Q}from"./index.4b91fb67.js";import{C as he}from"./index.41f81733.js";import{s as ge}from"./index.361d06fd.js";import"./use-route.3f983808.js";import"./index.a43dba5a.js";import"./index.70d893ee.js";import"./constant.80c6de18.js";import"./interceptor.de5b6308.js";import"./use-expose.aea2526e.js";import"./use-touch.53b51ffa.js";import"./use-lazy-render.0515f8b3.js";import"./on-popup-reopen.3f7ea527.js";import"./index.111f2b3a.js";import"./use-id.b9a85ecc.js";import"./index.97166d61.js";import"./index.b8fe9ef8.js";import"./index.0acc8c08.js";import"./Checker.29cf14f7.js";import"./mount-component.a3193047.js";const[ve,Y,R]=U("coupon-cell"),Ce={title:String,border:D,editable:D,coupons:M(),currency:S("\xA5"),chosenCoupon:X(-1)};function be({coupons:e,chosenCoupon:t,currency:i}){const s=e[+t];if(s){let n=0;return N(s.value)?{value:n}=s:N(s.denominations)&&(n=s.denominations),`-${i} ${(n/100).toFixed(2)}`}return e.length===0?R("noCoupon"):R("count",e.length)}const fe=_({name:ve,props:Ce,setup(e){return()=>{const t=e.coupons[+e.chosenCoupon];return o(oe,{class:Y(),value:be(e),title:e.title||R("title"),border:e.border,isLink:e.editable,valueClass:Y("value",{selected:t})},null)}}}),xe=V(fe);function Z(e){const t=new Date(e*1e3);return`${t.getFullYear()}.${j(t.getMonth()+1)}.${j(t.getDate())}`}const ye=e=>(e/10).toFixed(e%10===0?0:1),J=e=>(e/100).toFixed(e%100===0?0:e%10===0?1:2),[we,r,H]=U("coupon"),Be=_({name:we,props:{chosen:Boolean,coupon:ee(Object),disabled:Boolean,currency:S("\xA5")},setup(e){const t=m(()=>{const{startAt:n,endAt:u}=e.coupon;return`${Z(n)} - ${Z(u)}`}),i=m(()=>{const{coupon:n,currency:u}=e;if(n.valueDesc)return[n.valueDesc,o("span",null,[n.unitDesc||""])];if(n.denominations){const c=J(n.denominations);return[o("span",null,[u]),` ${c}`]}return n.discount?H("discount",ye(n.discount)):""}),s=m(()=>{const n=J(e.coupon.originCondition||0);return n==="0"?H("unlimited"):H("condition",n)});return()=>{const{chosen:n,coupon:u,disabled:c}=e,h=c&&u.reason||u.description;return o("div",{class:r({disabled:c})},[o("div",{class:r("content")},[o("div",{class:r("head")},[o("h2",{class:r("amount")},[i.value]),o("p",{class:r("condition")},[u.condition||s.value])]),o("div",{class:r("body")},[o("p",{class:r("name")},[u.name]),o("p",{class:r("valid")},[t.value]),!c&&o(he,{class:r("corner"),modelValue:n},null)])]),h&&o("p",{class:r("description")},[h])])}}}),K=V(Be),[De,d,x]=U("coupon-list"),Te={code:S(""),coupons:M(),currency:S("\xA5"),showCount:D,emptyImage:String,chosenCoupon:I(-1),enabledTitle:String,disabledTitle:String,disabledCoupons:M(),showExchangeBar:D,showCloseButton:D,closeButtonText:String,inputPlaceholder:String,exchangeMinLength:I(1),exchangeButtonText:String,displayedCouponIndex:I(-1),exchangeButtonLoading:Boolean,exchangeButtonDisabled:Boolean},ke=_({name:De,props:Te,emits:["change","exchange","update:code"],setup(e,{emit:t,slots:i}){const[s,n]=re(),u=g(),c=g(),h=g(0),y=g(0),l=g(e.code),T=m(()=>!e.exchangeButtonLoading&&(e.exchangeButtonDisabled||!l.value||l.value.length<e.exchangeMinLength)),k=()=>{const p=G(u).height,f=G(c).height+44;y.value=(p>f?p:q.value)-f},P=()=>{t("exchange",l.value),e.code||(l.value="")},E=a=>{se(()=>{var p;return(p=s.value[a])==null?void 0:p.scrollIntoView()})},v=()=>o(me,{image:e.emptyImage},{default:()=>[o("p",{class:d("empty-tip")},[x("noCoupon")])]}),b=()=>{if(e.showExchangeBar)return o("div",{ref:c,class:d("exchange-bar")},[o(pe,{modelValue:l.value,"onUpdate:modelValue":a=>l.value=a,clearable:!0,border:!1,class:d("field"),placeholder:e.inputPlaceholder||x("placeholder"),maxlength:"20"},null),o(Q,{plain:!0,type:"primary",class:d("exchange"),text:e.exchangeButtonText||x("exchange"),loading:e.exchangeButtonLoading,disabled:T.value,onClick:P},null)])},A=()=>{const{coupons:a}=e,p=e.showCount?` (${a.length})`:"",f=(e.enabledTitle||x("enable"))+p;return o(O,{title:f},{default:()=>{var w;return[o("div",{class:d("list",{"with-bottom":e.showCloseButton}),style:{height:`${y.value}px`}},[a.map((B,L)=>o(K,{key:B.id,ref:n(L),coupon:B,chosen:L===e.chosenCoupon,currency:e.currency,onClick:()=>t("change",L)},null)),!a.length&&v(),(w=i["list-footer"])==null?void 0:w.call(i)])]}})},$=()=>{const{disabledCoupons:a}=e,p=e.showCount?` (${a.length})`:"",f=(e.disabledTitle||x("disabled"))+p;return o(O,{title:f},{default:()=>{var w;return[o("div",{class:d("list",{"with-bottom":e.showCloseButton}),style:{height:`${y.value}px`}},[a.map(B=>o(K,{disabled:!0,key:B.id,coupon:B,currency:e.currency},null)),!a.length&&v(),(w=i["disabled-list-footer"])==null?void 0:w.call(i)])]}})};return F(()=>e.code,a=>{l.value=a}),F(q,k),F(l,a=>t("update:code",a)),F(()=>e.displayedCouponIndex,E),ne(()=>{k(),E(e.displayedCouponIndex)}),()=>o("div",{ref:u,class:d()},[b(),o(de,{active:h.value,"onUpdate:active":a=>h.value=a,class:d("tab")},{default:()=>[A(),$()]}),o("div",{class:d("bottom")},[te(o(Q,{round:!0,block:!0,type:"primary",class:d("close"),text:e.closeButtonText||x("close"),onClick:()=>t("change",-1)},null),[[ae,e.showCloseButton]])])])}}),Ee=V(ke),no=_({__name:"index",setup(e){const t=W({"zh-CN":{coupon:{name:"\u4F18\u60E0\u5238\u540D\u79F0",reason:"\u4F18\u60E0\u5238\u4E0D\u53EF\u7528\u539F\u56E0",description:"\u63CF\u8FF0\u4FE1\u606F"},exchange:"\u5151\u6362\u6210\u529F"},"en-US":{coupon:{name:"Coupon name",reason:"Coupon unavailable reason",description:"Description"},exchange:"Success"}}),i=(v=999999)=>String(Math.floor(Math.random()*v)+1),s=g(!1),n=g(-1),u=g([]),c=m(()=>({id:1,condition:`\u65E0\u95E8\u69DB
\u6700\u591A\u4F18\u60E012\u5143`,reason:"",value:150,name:t("coupon.name"),description:t("coupon.description"),startAt:1489104e3,endAt:1514592e3,valueDesc:"1.5",unitDesc:"\u5143"})),h=m(()=>({...c.value,id:2,value:12,valueDesc:"8.8",unitDesc:"\u6298"})),y=m(()=>({...c.value,id:3,reason:t("coupon.reason")})),l=m(()=>({...h.value,valueDesc:"1",unitDesc:"\u6298",id:4,reason:t("coupon.reason")})),T=m(()=>[c.value,h.value,...u.value]),k=m(()=>[y.value,l.value]),P=v=>{s.value=!1,n.value=v},E=()=>{ge(t("exchange")),u.value.push({...c.value,id:i()})};return(v,b)=>{const A=ue("demo-block");return ce(),ie(A,{title:C(t)("basicUsage")},{default:z(()=>[o(C(xe),{coupons:C(T),"chosen-coupon":n.value,onClick:b[0]||(b[0]=$=>s.value=!0)},null,8,["coupons","chosen-coupon"]),o(C(le),{show:s.value,"onUpdate:show":b[1]||(b[1]=$=>s.value=$),round:"",position:"bottom",style:{height:"90%","padding-top":"4px"}},{default:z(()=>[o(C(Ee),{coupons:C(T),"chosen-coupon":n.value,"disabled-coupons":C(k),onChange:P,onExchange:E},null,8,["coupons","chosen-coupon","disabled-coupons"])]),_:1},8,["show"])]),_:1},8,["title"])}}});export{no as default};
