import{c as E,n as J,l as D,F as C,M as ee,Q as oe,p as te,r as ae,d as se,e as ne}from"./use-translate.5fa8a2a1.js";import{m as ie,u as ce}from"./mount-component.6bbd68ed.js";import{A as O,H as _,u as F,D as T,x as b,e as m,M as le,q as re,B as L,Q as me}from"./vue-libs.ed3d9812.js";import{d as Y,n as N,t as H,b as ue,c as Z,u as k,m as A,w as de}from"./with-install.ff23f643.js";import{H as ve}from"./constant.80c6de18.js";import{c as fe}from"./interceptor.f92ff708.js";import{u as ge}from"./use-expose.840221e5.js";import{I as he}from"./index.dc9079c8.js";import{a as we,S as Pe}from"./index.fe913e31.js";import{P as pe}from"./index.5bc144fc.js";import{u as Ie}from"./use-touch.ecfb8eef.js";import{I as xe}from"./index.89613652.js";import{L as ye}from"./index.200bbe9c.js";const $=o=>Math.sqrt((o[0].clientX-o[1].clientX)**2+(o[0].clientY-o[1].clientY)**2),B=E("image-preview")[1],Se=O({props:{src:String,show:Boolean,active:Number,minZoom:Y(N),maxZoom:Y(N),rootWidth:Y(Number),rootHeight:Y(Number)},emits:["scale","close"],setup(o,{emit:c}){const e=_({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),l=Ie(),i=F(),v=T(()=>{const{rootWidth:t,rootHeight:s}=o,n=s/t;return e.imageRatio>n}),M=T(()=>{const{scale:t,moveX:s,moveY:n,moving:d,zooming:x}=e,X={transitionDuration:x||d?"0s":".3s"};if(t!==1){const K=s/t,G=n/t;X.transform=`scale(${t}, ${t}) translate(${K}px, ${G}px)`}return X}),f=T(()=>{if(e.imageRatio){const{rootWidth:t,rootHeight:s}=o,n=v.value?s/e.imageRatio:t;return Math.max(0,(e.scale*n-t)/2)}return 0}),g=T(()=>{if(e.imageRatio){const{rootWidth:t,rootHeight:s}=o,n=v.value?s:t*e.imageRatio;return Math.max(0,(e.scale*n-s)/2)}return 0}),h=t=>{t=C(t,+o.minZoom,+o.maxZoom+1),t!==e.scale&&(e.scale=t,c("scale",{scale:t,index:o.active}))},S=()=>{h(1),e.moveX=0,e.moveY=0},R=()=>{const t=e.scale>1?1:2;h(t),e.moveX=0,e.moveY=0};let w,P,p,I,a,r,u;const q=t=>{const{touches:s}=t,{offsetX:n}=l;l.start(t),w=s.length,P=e.moveX,p=e.moveY,u=Date.now(),e.moving=w===1&&e.scale!==1,e.zooming=w===2&&!n.value,e.zooming&&(I=e.scale,a=$(t.touches))},Q=t=>{const{touches:s}=t;if(l.move(t),(e.moving||e.zooming)&&D(t,!0),e.moving){const{deltaX:n,deltaY:d}=l,x=n.value+P,X=d.value+p;e.moveX=C(x,-f.value,f.value),e.moveY=C(X,-g.value,g.value)}if(e.zooming&&s.length===2){const n=$(s),d=I*n/a;h(d)}},U=()=>{if(w>1)return;const{offsetX:t,offsetY:s}=l,n=Date.now()-u,d=250,x=5;t.value<x&&s.value<x&&n<d&&(r?(clearTimeout(r),r=null,R()):r=setTimeout(()=>{c("close"),r=null},d))},W=t=>{let s=!1;(e.moving||e.zooming)&&(s=!0,e.moving&&P===e.moveX&&p===e.moveY&&(s=!1),t.touches.length||(e.zooming&&(e.moveX=C(e.moveX,-f.value,f.value),e.moveY=C(e.moveY,-g.value,g.value),e.zooming=!1),e.moving=!1,P=0,p=0,I=1,e.scale<1&&S(),e.scale>o.maxZoom&&(e.scale=+o.maxZoom))),D(t,s),U(),l.reset()},V=t=>{const{naturalWidth:s,naturalHeight:n}=t.target;e.imageRatio=n/s};return b(()=>o.active,S),b(()=>o.show,t=>{t||S()}),J("touchmove",Q,{target:T(()=>{var t;return(t=i.value)==null?void 0:t.$el})}),()=>{const t={loading:()=>m(ye,{type:"spinner"},null)};return m(we,{ref:i,class:B("swipe-item"),onTouchstartPassive:q,onTouchend:W,onTouchcancel:W},{default:()=>[m(xe,{src:o.src,fit:"contain",class:B("image",{vertical:v.value}),style:M.value,onLoad:V},t)]})}}});function Ce(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!me(o)}const[Te,y]=E("image-preview"),be=["show","transition","overlayStyle","closeOnPopstate"],Xe={show:Boolean,loop:H,images:ue(),minZoom:Z(1/3),maxZoom:Z(3),overlay:H,closeable:Boolean,showIndex:H,className:k,closeIcon:A("clear"),transition:String,beforeClose:Function,overlayClass:k,overlayStyle:Object,swipeDuration:Z(300),startPosition:Z(0),showIndicators:Boolean,closeOnPopstate:H,closeIconPosition:A("top-right")},j=O({name:Te,props:Xe,emits:["scale","close","closed","change","update:show"],setup(o,{emit:c,slots:e}){const l=F(),i=_({active:0,rootWidth:0,rootHeight:0}),v=()=>{if(l.value){const a=ae(l.value.$el);i.rootWidth=a.width,i.rootHeight=a.height,l.value.resize()}},M=a=>c("scale",a),f=a=>c("update:show",a),g=()=>{fe(o.beforeClose,{args:[i.active],done:()=>f(!1)})},h=a=>{a!==i.active&&(i.active=a,c("change",a))},S=()=>{if(o.showIndex)return m("div",{class:y("index")},[e.index?e.index({index:i.active}):`${i.active+1} / ${o.images.length}`])},R=()=>{if(e.cover)return m("div",{class:y("cover")},[e.cover()])},w=()=>{let a;return m(Pe,{ref:l,lazyRender:!0,loop:o.loop,class:y("swipe"),duration:o.swipeDuration,initialSwipe:o.startPosition,showIndicators:o.showIndicators,indicatorColor:"white",onChange:h},Ce(a=o.images.map(r=>m(Se,{src:r,show:o.show,active:i.active,maxZoom:o.maxZoom,minZoom:o.minZoom,rootWidth:i.rootWidth,rootHeight:i.rootHeight,onScale:M,onClose:g},null)))?a:{default:()=>[a]})},P=()=>{if(o.closeable)return m(he,{role:"button",name:o.closeIcon,class:[y("close-icon",o.closeIconPosition),ve],onClick:g},null)},p=()=>c("closed"),I=(a,r)=>{var u;return(u=l.value)==null?void 0:u.swipeTo(a,r)};return ge({swipeTo:I}),le(v),b([ee,oe],v),b(()=>o.startPosition,a=>h(+a)),b(()=>o.show,a=>{const{images:r,startPosition:u}=o;a?(h(+u),re(()=>{v(),I(+u,{immediate:!0})})):c("close",{index:i.active,url:r[i.active]})}),()=>m(pe,L({class:[y(),o.className],overlayClass:[y("overlay"),o.overlayClass],onClosed:p,"onUpdate:show":f},te(o,be)),{default:()=>[P(),w(),S(),R()]})}});let z;const Ye={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function He(){({instance:z}=ie({setup(){const{state:o,toggle:c}=ce(),e=()=>{o.images=[]};return()=>m(j,L(o,{onClosed:e,"onUpdate:show":c}),null)}}))}const _e=(o,c=0)=>{if(!!se)return z||He(),o=Array.isArray(o)?{images:o,startPosition:c}:o,z.open(ne({},Ye,o)),z},Fe=de(j);export{Fe as I,_e as s};
